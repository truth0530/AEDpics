# Inspection UI/UX Consistency Skill

## Purpose
점검 기능의 모든 화면에서 일관된 사용자 경험을 제공하여 사용자 혼란을 최소화하고 작업 효율성을 극대화합니다.

## 핵심 원칙

### 1. 상태별 시각적 구별
모든 점검 관련 화면에서 다음 3가지 상태를 즉시 식별할 수 있어야 합니다:
- **완료된 점검** (Completed): 파란색 계열, 체크 아이콘, "완료" 배지
- **진행 중인 점검** (In Progress): 주황색 계열, 시간 아이콘, "진행중" 배지
- **예정된 점검** (Scheduled): 회색 계열, 달력 아이콘, "예정" 배지

### 2. 버튼 색상 규칙
```
Primary Action (저장/완료)  : 파란색 (bg-blue-600/hover:bg-blue-700)
Secondary Action (다음/계속) : 초록색 (bg-emerald-600/hover:bg-emerald-700)
Danger Action (삭제/취소)   : 빨간색 (bg-red-600/hover:bg-red-700)
Info Action (도움말)       : 회색 (bg-gray-600/hover:bg-gray-700)
```

### 3. 사용자 의도 확인 (Confirmation)
- 중요 작업(저장, 삭제, 원복)은 모달/다이얼로그로 확인 필수
- 확인 메시지는 명확한 행동 결과 표시
- 예: "저장하시겠습니까?" (❌) → "이 항목을 저장하고 다음 단계로 진행하시겠습니까?" (✅)

---

## 화면별 상호작용 패턴

## Phase 1: 기존 내용 확인 후 일치 (Verify & Agree)

### 시나리오
사용자가 기존 점검 내용을 읽고 "내용이 맞습니다"를 확인하는 경우

### UI 레이아웃
```
┌─────────────────────────────────────┐
│ 기존 점검 내용                       │
├─────────────────────────────────────┤
│ - 점검 날짜: 2025-11-09             │
│ - 점검자: OOO                       │
│ - 장비 상태: 양호                   │
│ - 문제 사항: 없음                   │
├─────────────────────────────────────┤
│ [이전 단계]  [내용 수정]  [일치하여 계속] │
└─────────────────────────────────────┘
```

### 버튼 상호작용
```
상태          버튼명           색상     아이콘    동작
─────────────────────────────────────────────────
기본          "내용 수정"      gray     Edit     수정 모드 진입
기본          "일치하여 계속"  blue     Check    다음 단계 진행
수정 중       "변경사항 저장"  emerald  Save     저장 후 다음 진행
확인 필요     "필수항목 입력"  red      Alert    필드 강조 표시
```

### 색상 변경 원칙
```
1. 버튼 활성화 조건
   - 필수 항목이 모두 입력되었는가? → 파란색으로 활성화
   - 입력이 미완료 상태인가? → 회색으로 비활성화 (disabled)

2. 버튼 상태 시각화
   Disabled: opacity-50, cursor-not-allowed, text-gray-500
   Enabled:  opacity-100, cursor-pointer, text-white
   Hover:    brightness-110 (밝아짐)
   Focus:    ring-2 ring-offset-2 ring-blue-500

3. 프로그레스 표시
   현재 단계를 파란색으로, 완료된 단계를 회색으로 표시
```

---

## Phase 2: 기존 내용 확인 후 수정

### 시나리오 A: 수정 완료 후 저장
```
View Mode (읽기 전용)
    ↓ [내용 수정] 클릭
Edit Mode (편집 가능)
    ↓ 사용자가 내용 변경
    ↓ [변경사항 저장] 클릭 (파란색, 활성화)
    ↓ 확인 모달 표시
    "다음과 같이 저장하시겠습니까?"
    [변경사항 미리보기]
    [취소] [저장]
    ↓ 저장 완료
Success Message: "항목이 저장되었습니다"
    ↓
View Mode (읽기 전용) - 변경된 내용 표시
```

### 시나리오 B: 수정 취소 및 원복
```
View Mode (읽기 전용)
    ↓ [내용 수정] 클릭
Edit Mode (편집 가능)
    ↓ 사용자가 내용 변경
    ↓ [취소] 클릭 (회색)
    ↓ 확인 모달 표시
    "변경사항이 저장되지 않습니다. 계속하시겠습니까?"
    [현재 변경사항] vs [원본 내용] 비교 표시
    [계속 수정] [원복]
    ↓ 사용자가 [원복] 선택
    ↓
View Mode (읽기 전용) - 원본 내용 복원
Success Message: "변경사항이 취소되었습니다"
```

### 수정 모드 UI 특징
```
입력 필드:
- 배경: bg-gray-800 (다른 색으로 구별)
- 테두리: border-blue-500 (진행 중임을 표시)
- 포커스: ring-2 ring-blue-400

변경 감지:
- 원본과 현재 데이터 비교 (isEqual 사용)
- 변경 있음: "저장" 버튼 활성화 (파란색)
- 변경 없음: "저장" 버튼 비활성화 (회색)

상태 표시:
- 상단: "수정 중" 배지 (주황색)
- 하단: "저장되지 않음" 경고 표시
```

---

## Phase 3: 최종 결정 후 조치 사항 활성화

### 시나리오: 유효기간 경과 감지
```
사용자가 점검 내용 리뷰 중:

1. 시스템이 유효기간 경과 감지
   ├─ 확인: last_inspection_date_egen vs 현재 날짜
   └─ 간격이 12개월 이상이면 "경과" 표시

2. 경고 메시지 표시 (주황색 박스)
   ┌──────────────────────────────────┐
   │ ⚠ 유효기간 경과 안내              │
   │ 최근 정기점검: 2024-11-01         │
   │ 경과일: 373일 (12개월 이상)       │
   │ → 조치사항을 입력해주세요         │
   └──────────────────────────────────┘

3. 조치사항 입력 필드 활성화
   - 필드: TextArea (최대 500자)
   - 라벨: "경과 관련 조치사항"
   - 필수: 유효기간 경과 시 필수 입력
   - 플레이홀더: "수리, 교체, 폐기 등의 조치를 기록해주세요"

4. 저장 전 검증
   - 경과됨이 감지된 경우, 조치사항이 없으면 저장 불가
   - 경고: "유효기간 경과 항목에 대한 조치사항을 입력해주세요"

5. 저장 흐름
   [저장] 클릭 (파란색)
     ↓
   확인 모달:
   "유효기간 경과에 대한 조치사항이 포함되어 있습니다. 저장하시겠습니까?"
   [변경사항 미리보기]
   [취소] [저장]
     ↓
   저장 완료
   Success Message: "점검 정보가 저장되었습니다. 조치사항: [입력내용]"
```

### 조치사항 활성화 규칙
```
필드 활성화 조건:
1. 유효기간 경과 (gap >= 12개월)
2. 배터리 상태 부실 (battery_status = 'expired' 등)
3. 보관함 손상 (storage_condition = 'damaged' 등)
4. 기타 심각한 문제 발견

필드 상태:
Inactive: opacity-50, cursor-not-allowed, bg-gray-700
Active:   opacity-100, cursor-text, bg-gray-800
Focus:    ring-2 ring-blue-400, border-blue-500

저장 가능 여부:
- 문제 감지 + 조치사항 입력 → 저장 가능 (파란색)
- 문제 감지 + 조치사항 없음 → 저장 불가 (회색, disabled)
```

---

## Phase 4: 점검 세션 필수항목 입력 흐름

### 시나리오: 다음 단계로 진행 시

#### 4-1. 필수항목 입력 완료 (정상 흐름)
```
현재 단계 (Step 1)
├─ 필드 A (필수): ✅ 입력됨
├─ 필드 B (필수): ✅ 입력됨
└─ 필드 C (선택): ⭕ 입력 안 함

[이전 단계] [저장 후 다음] [임시 저장]
     ↓
사용자가 [저장 후 다음] 클릭 (파란색)
     ↓
시스템: 필수항목 검증 → 모두 입력됨 ✅
     ↓
확인 모달:
"Step 1의 내용을 저장하고 Step 2로 이동하시겠습니까?"
[미리보기] [취소] [다음 단계]
     ↓
다음 단계로 자동 진행
Success Message: "Step 1이 저장되었습니다"
```

#### 4-2. 필수항목 미입력 (경고 표시)
```
현재 단계 (Step 1)
├─ 필드 A (필수): ❌ 입력 안 함
├─ 필드 B (필수): ✅ 입력됨
└─ 필드 C (선택): ⭕ 입력 안 함

[이전 단계] [저장 후 다음] [임시 저장]
     ↓
사용자가 [저장 후 다음] 클릭 (실제로는 disabled 상태이므로 클릭 불가)
     ↓
대신, [필수항목 확인] 모달이 자동 표시
┌──────────────────────────────────┐
│ 필수항목을 모두 입력해주세요      │
├──────────────────────────────────┤
│ ❌ 필드 A: 입력 필수              │
│ ✅ 필드 B: 입력됨                 │
└──────────────────────────────────┘
[필드 A로 이동] [닫기]
     ↓
사용자가 [필드 A로 이동] 클릭
     ↓
필드 A로 자동 스크롤 + 입력 필드 포커스
```

### 3가지 진행 방식 선택
```
1️⃣ 저장 후 다음 진행 (기본)
   - 모든 필수항목 입력 필수
   - 데이터베이스에 저장됨
   - 나중에 돌아와서 이어서 작성 가능

2️⃣ 임시 저장 (선택)
   - 필수항목 미입력 상태로도 저장 가능
   - "임시 저장됨" 상태 유지
   - 다음 단계로 진행 불가
   - 사용자가 나중에 돌아와서 계속 작성 가능

3️⃣ 자연스러운 이동 (권장)
   - 필수항목이 모두 입력되면 자동으로 다음 단계 버튼 활성화
   - 강제로 다음 단계로 넘기지 않음
   - 사용자가 현재 단계에서 충분히 검토 후 진행
   - 입력 중간에 실수로 나가는 것 방지
```

### 권장 UX 패턴: 혼합형
```
상황별 처리 방식:

1. 사용자가 입력을 진행 중 (80% 입력)
   → "임시 저장" 제공
   → 다른 일 보다가 돌아올 수 있도록 지원

2. 필수항목만 남음 (필드 A, B 미입력)
   → 경고 모달 표시
   → 필드로 직접 이동 기능 제공
   → [다음] 버튼 disabled 유지

3. 모든 필수항목 입력됨
   → [다음 단계] 버튼 활성화 (파란색)
   → 클릭 시 확인 모달 표시
   → 확인 후 자동 진행
```

---

## Phase 5: 점검 완료 후 리뷰 화면

### 화면 구성
```
┌─────────────────────────────────────────────────┐
│ 점검 요약 및 검토                              │
├─────────────────────────────────────────────────┤
│                                                 │
│ [1단계 기본정보]  [2단계 장비]  [3단계 보관함]  │
│ [4단계 점검요약]  [검증 결과]                  │
│                                                 │
├─────────────────────────────────────────────────┤
│ 누락된 항목 확인                               │
├─────────────────────────────────────────────────┤
│ ✅ 기본정보:     완료 (모든 필드 입력됨)      │
│ ✅ 장비정보:     완료 (모든 필드 입력됨)      │
│ ⚠️ 보관함:      경고 (배터리 상태 미정의)    │
│ ❌ 조치사항:     미입력 (유효기간 경과)      │
│                                                 │
├─────────────────────────────────────────────────┤
│ 검증 결과 요약                                 │
├─────────────────────────────────────────────────┤
│ 총 필수항목: 23개 / 입력: 21개 / 미입력: 2개  │
│ 완성도: 91%                                   │
│                                                 │
│ [문제 있음] → 수정 필요 항목:                  │
│ 1. 조치사항: 유효기간 경과로 필수항목         │
│ 2. 보관함 상태: 선택값 확인 필요              │
│                                                 │
├─────────────────────────────────────────────────┤
│ [이전 단계]  [문제 항목 수정]  [완료 및 제출] │
└─────────────────────────────────────────────────┘
```

### 누락 항목 감지 및 표시
```
검증 로직:
1. 각 단계별 필수 필드 정의
   REQUIRED_FIELDS = {
     step1: ['basicInfo.date', 'basicInfo.location', ...],
     step2: ['deviceInfo.serialNumber', 'deviceInfo.status', ...],
     step3: ['storage.condition', 'storage.battery', ...],
     step4: ['summary.overallStatus', 'summary.notes', ...]
   }

2. 각 필드의 입력 여부 확인
   - 필드 값이 null이거나 빈 문자열? → 미입력
   - 배열인 경우 길이 > 0? → 입력됨
   - 객체인 경우 필요한 키 존재? → 입력됨

3. 결과 표시
   ✅ 입력됨: 녹색 체크마크
   ⚠️  부분입력: 주황색 경고
   ❌ 미입력: 빨간색 X 표시

4. 액션 제공
   - 각 항목 옆에 [수정] 버튼
   - 클릭 시 해당 단계로 즉시 이동
   - 필드에 자동 포커스
```

---

## Phase 6: 점검 상태 구별 및 다음 액션 표시

### 점검 목록 화면에서의 상태 표시

#### 6-1. 점검 상태 배지
```
┌─────────────────────────────────────────────────────┐
│ 장비 목록                                          │
├─────────────────────────────────────────────────────┤
│                                                     │
│ 장비 #1 (SN12345)                                 │
│ ┌───────────────────────────────────────────────┐ │
│ │ [완료] 2025-11-09 10:30                       │ │
│ │ 점검자: 홍길동 | 상태: 양호                   │ │
│ │ [점검 이력 보기] [수정] [삭제]               │ │
│ └───────────────────────────────────────────────┘ │
│                                                     │
│ 장비 #2 (SN12346)                                 │
│ ┌───────────────────────────────────────────────┐ │
│ │ [진행중] (72% 완료)                           │ │
│ │ 현재 단계: Step 3 보관함 점검                │ │
│ │ [계속 진행] [임시 저장] [취소]               │ │
│ └───────────────────────────────────────────────┘ │
│                                                     │
│ 장비 #3 (SN12347)                                 │
│ ┌───────────────────────────────────────────────┐ │
│ │ [예정] (2025-11-15 예약됨)                   │ │
│ │ 예약된 점검원: 김영희                         │ │
│ │ [점검 시작] [예약 변경] [취소]               │ │
│ └───────────────────────────────────────────────┘ │
│                                                     │
└─────────────────────────────────────────────────────┘
```

#### 6-2. 상태별 배지 스타일
```
완료된 점검:
- 배경: bg-blue-900/30
- 텍스트: text-blue-300
- 아이콘: ✅ CheckCircle
- 배지: "완료" (파란색)

진행 중인 점검:
- 배경: bg-amber-900/30
- 텍스트: text-amber-300
- 아이콘: ⏳ Clock
- 배지: "진행중" (주황색)
- 추가: 진행률 바 표시 (72% 완료)

예정된 점검:
- 배경: bg-gray-700/30
- 텍스트: text-gray-400
- 아이콘: 📅 Calendar
- 배지: "예정" (회색)
- 추가: 예정된 날짜 표시
```

#### 6-3. 다음 액션 버튼
```
완료된 점검:
[점검 이력 보기] (파란색 - primary)
[수정]         (회색 - secondary)
[삭제]         (빨간색 - danger)

진행 중인 점검:
[계속 진행]     (파란색 - primary)
[임시 저장]     (초록색 - secondary)
[취소]         (빨간색 - danger)

예정된 점검:
[점검 시작]     (파란색 - primary)
[예약 변경]     (회색 - secondary)
[취소]         (빨간색 - danger)
```

---

## 검증 체크리스트

### 화면별 검증 항목

#### ✅ 기존 내용 확인 화면
- [ ] 기존 내용이 명확하게 표시되는가?
- [ ] "내용 수정" 버튼이 회색으로 표시되는가?
- [ ] "일치하여 계속" 버튼이 파란색으로 표시되는가?
- [ ] 필수항목이 모두 입력되어야 버튼이 활성화되는가?

#### ✅ 수정 모드 화면
- [ ] 입력 필드의 배경이 다른 색(bg-gray-800)으로 구별되는가?
- [ ] 테두리가 파란색(border-blue-500)으로 표시되는가?
- [ ] "수정 중" 배지가 상단에 표시되는가?
- [ ] 원본 내용과 현재 내용이 다르면 "저장" 버튼이 활성화되는가?
- [ ] 변경이 없으면 "저장" 버튼이 비활성화되는가?

#### ✅ 조치사항 입력 화면
- [ ] 문제 감지 시 경고 메시지가 표시되는가?
- [ ] 조치사항 필드가 활성화되는가?
- [ ] 조치사항 입력 없이 저장할 수 없는가?
- [ ] 저장 전 확인 모달에 조치사항이 표시되는가?

#### ✅ 점검 세션 필수항목 화면
- [ ] 필수항목이 표시되는가? (필드명 + ✅ 또는 ❌)
- [ ] 필수항목이 모두 입력되면 [다음] 버튼이 활성화되는가?
- [ ] 필수항목이 미입력되면 경고 모달이 표시되는가?
- [ ] 경고 모달에서 필드로 직접 이동할 수 있는가?
- [ ] [임시 저장] 버튼으로 미완성 상태로 저장할 수 있는가?

#### ✅ 리뷰 화면
- [ ] 4개 단계의 탭이 모두 표시되는가?
- [ ] 각 단계별 완성도가 표시되는가?
- [ ] 누락된 항목이 명확하게 표시되는가?
- [ ] 각 항목 옆에 [수정] 버튼이 있는가?
- [ ] [수정] 버튼 클릭 시 해당 단계로 이동하는가?
- [ ] 전체 완성도(%)가 계산되어 표시되는가?
- [ ] 문제 항목 목록이 정렬되어 표시되는가?

#### ✅ 점검 목록 화면
- [ ] 각 점검의 상태(완료/진행중/예정)가 배지로 표시되는가?
- [ ] 배지 색상이 상태별로 다른가?
- [ ] 진행 중인 점검의 진행률이 표시되는가?
- [ ] 각 상태별 액션 버튼이 표시되는가?
- [ ] 다음 액션이 명확하게 제시되는가?

---

## 버튼 상태 매트릭스

### 활성화/비활성화 조건
```
버튼          활성화 조건                    비활성화 조건
────────────────────────────────────────────────────
일치하여계속  모든 필수항목 입력됨          필수항목 미입력
저장         원본과 현재값이 다름          원본과 동일
변경사항저장  필수항목 입력 + 변경 있음    필수항목 미입력
수정         권한 있음                     권한 없음
삭제         권한 있음                     권한 없음
다음단계    모든 필수항목 입력됨          필수항목 미입력
임시저장    세션 데이터 존재              세션 없음
점검완료    모든 필수항목 입력됨          필수항목 미입력
```

---

## 구현 가이드

### 1. 상태 감지 함수
```typescript
// components/inspection/utils/validation.ts

export function validateRequiredFields(
  stepData: Record<string, unknown>,
  requiredFields: string[]
): { isValid: boolean; missingFields: string[] } {
  const missing = requiredFields.filter(field => {
    const value = getNestedValue(stepData, field);
    return value === null || value === undefined || value === '';
  });

  return {
    isValid: missing.length === 0,
    missingFields: missing
  };
}

export function detectProblems(inspection: InspectionData): Problem[] {
  const problems: Problem[] = [];

  // 유효기간 경과 감지
  if (isExpired(inspection.last_inspection_date_egen)) {
    problems.push({
      type: 'expired',
      severity: 'critical',
      message: '유효기간이 경과되었습니다',
      requiresAction: true
    });
  }

  // 배터리 상태 확인
  if (inspection.battery_status === 'expired') {
    problems.push({
      type: 'battery',
      severity: 'high',
      message: '배터리 교체 필요',
      requiresAction: true
    });
  }

  return problems;
}

export function getCompletionPercentage(
  stepData: Record<string, unknown>,
  allRequiredFields: Record<string, string[]>
): number {
  let total = 0;
  let filled = 0;

  Object.values(allRequiredFields).forEach(fields => {
    total += fields.length;
    fields.forEach(field => {
      const value = getNestedValue(stepData, field);
      if (value !== null && value !== undefined && value !== '') {
        filled++;
      }
    });
  });

  return Math.round((filled / total) * 100);
}
```

### 2. 컴포넌트 패턴
```typescript
// 버튼 활성화 조건 예시
<button
  onClick={handleSave}
  disabled={!isChanged || !isValid}
  className={cn(
    'px-4 py-2 rounded font-medium transition',
    isChanged && isValid
      ? 'bg-blue-600 hover:bg-blue-700 text-white cursor-pointer'
      : 'bg-gray-600 text-gray-400 cursor-not-allowed opacity-50'
  )}
>
  저장
</button>

// 경고 메시지 표시
{problems.length > 0 && (
  <div className="bg-amber-900/30 border border-amber-700 rounded p-3 mb-4">
    <h4 className="text-amber-300 font-semibold mb-2">조치 필요</h4>
    <ul className="space-y-1">
      {problems.map(problem => (
        <li key={problem.type} className="text-amber-200 text-sm">
          - {problem.message}
        </li>
      ))}
    </ul>
  </div>
)}
```

---

## 참고 문서
- [INSPECTION_APPROVAL_WORKFLOW.md](docs/operations/INSPECTION_APPROVAL_WORKFLOW.md) - 점검 승인 워크플로우
- [InspectionHistoryModal.tsx](components/inspection/InspectionHistoryModal.tsx) - 점검 이력 상세 모달
- [InspectionWorkflow.tsx](components/inspection/InspectionWorkflow.tsx) - 점검 세션 워크플로우
- [inspection-session-store.ts](lib/state/inspection-session-store.ts) - 세션 상태 관리
- [Role-based Access](lib/auth/role-matrix.ts) - 권한 기반 UI 표시
