name: Daily Mode Parameter Logging Verification

on:
  schedule:
    # 매일 09:00 UTC (한국 시간 18:00)
    - cron: '0 9 * * *'
  workflow_dispatch:

jobs:
  verify-logging:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '20'
        cache: 'npm'

    - name: Install dependencies
      run: npm ci

    - name: Run mode logging verification
      run: npx tsx scripts/verify-mode-logging.ts
      env:
        DATABASE_URL: ${{ secrets.DATABASE_URL }}

    - name: Check for anomalies in logs
      run: |
        echo "Mode Logging Verification Complete"
        echo "Next step: Check PM2 production logs for mode parameter usage"
        echo "Command: pm2 logs app --lines 100 | grep -E 'InspectionHistory|mode:'"

    - name: Notify on failure
      if: failure()
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.createComment({
            issue_number: context.issue.number,
            owner: context.repo.owner,
            repo: context.repo.repo,
            body: '⚠️ Mode logging verification failed. Check production logs.'
          })
