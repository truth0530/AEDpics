# 스마트 발신자 선택 시스템 실패 분석
## 2025-11-22: 실제 배포 후 실패 기록

### 요약
**스마트 발신자 선택(동적 로테이션) 시스템은 Daum 이메일 차단 문제를 해결하지 못했습니다.**

- 기간: 2025-11-21 15:01 ~ 2025-11-22 00:04
- 영향: Daum 사용자 이메일 발송 완전 실패
- 결론: 발신자 로테이션은 근본 해결이 아니며, NCP 기술 지원팀의 화이트리스트 등록이 필수

---

## 실패 사례 및 데이터

### 테스트 케이스

#### 1. truth530@daum.net (2025-11-21 23:50 ~ 2025-11-22 00:01)
**코드 상태**: Daum = `['noreply@nmc.or.kr', 'noreply@aed.pics']`

| 시간 | 발신자 | NCP 결과 | 로그 상태 | 상태 불일치 |
|------|--------|---------|---------|----------|
| 2025-11-22 00:01:16 | noreply@nmc.or.kr | 발송실패 | Success ✓ | ✗ |

**결과**: 1/1 실패 (100%)

#### 2. wowow212@daum.net (2025-11-22 00:04)
**코드 상태**: Daum = `['noreply@aed.pics', 'noreply@nmc.or.kr']`

| 시간 | 발신자 | NCP 결과 | 로그 상태 | 상태 불일치 |
|------|--------|---------|---------|----------|
| 2025-11-22 00:04:27 | noreply@aed.pics | 발송실패 | Success ✓ | ✗ |

**결과**: 1/1 실패 (100%)

### 누적 발송 이력 (모든 Daum 시도)

```
noreply@aed.pics (Daum):
- 2025-11-21 23:52:33 → 발송성공 ✓ (이전 테스트)
- 2025-11-21 23:26:57 → 발송성공 ✓ (이전 테스트)
- 2025-11-21 23:54:16 → 발송실패 ✗
- 2025-11-21 23:24:30 → 발송실패 ✗
- 2025-11-22 00:04:27 → 발송실패 ✗
= 성공률: 40% (2/5)

noreply@nmc.or.kr (Daum):
- 2025-11-21 23:41:04 → 발송실패 ✗
- 2025-11-21 23:38:07 → 발송실패 ✗
- 2025-11-21 22:21:05 → 발송실패 ✗
- 2025-11-22 00:01:16 → 발송실패 ✗
= 성공률: 0% (0/4)
```

---

## 근본 원인 분석

### 문제 1: 스마트 발신자 선택의 가정 오류

**가정**: 두 발신자 중 하나는 항상 성공할 것이다.
```
Daum 발송 시도:
1차: noreply@aed.pics
  ├─ 성공 → 이전 실패 기록 제거
  └─ 실패 → 캐시에 기록
     2차: noreply@nmc.or.kr
       ├─ 성공 ✓
       └─ 실패 → "둘 다 실패" 상황
```

**현실**: 둘 다 실패할 수 있다.
```
실제 발생:
2025-11-21 23:54:16: noreply@aed.pics → 실패 (비록 00:04에 성공하기도 함)
2025-11-22 00:01:16: noreply@nmc.or.kr → 실패 (계속 차단)
2025-11-22 00:04:27: noreply@aed.pics → 다시 실패
```

### 문제 2: NCP의 자동 보안 정책

**메커니즘**:
1. NCP가 Daum 도메인에서 발송 오류 감지
2. 자동으로 해당 주소를 Daum 수신 거부 목록(Block List)에 추가
3. 정해진 시간 후 자동 제거 (수동 제거 후에도 재추가)

**증거**:
- truth530@daum.net: 4번 실패 중 3번 다른 발신자로도 연달아 실패
- wowow212@daum.net: 첫 시도부터 noreply@aed.pics로 즉시 실패
- 시간대별 패턴: 특정 발신자가 계속 차단되는 것이 아닌, Daum 주소 자체가 차단

### 문제 3: 로그와 실제 상태의 불일치

**개발서버 로그**: "Email sending success recorded" ✓
```
[SmartSender:Success] Email sending success recorded
  recipient: truth530@daum.net
  sender: noreply@nmc.or.kr
```

**NCP 콘솔**: "발송실패" ✗
```
2025-11-22 00:01:16 - noreply@nmc.or.kr → truth530@daum.net
발송상태: 발송실패
```

**원인**: NCP API가 HTTP 200으로 요청을 수락했으나, 이후 자동 보안 정책으로 발송 거부함.

---

## 스마트 발신자 선택 시스템의 한계

### 설계 한계

| 가정 | 현실 | 결과 |
|------|------|------|
| 두 발신자 중 하나는 성공 | 둘 다 차단될 수 있음 | 실패 |
| 1시간 캐시 리셋 = 새로운 기회 | NCP 자동 재추가 | 무의미 |
| 메모리 캐시 = 동작 추적 | NCP 내부 상태와 비동기 | 부정확 |

### 스마트 발신자 선택이 해결하지 못하는 문제

1. **수신사의 자동 차단 (Daum)**
   - 발신자 변경 ≠ 차단 해제
   - 근본 원인: Daum의 NCP 도메인 신뢰도 낮음

2. **NCP의 자동 보안 정책**
   - 발송 오류 감지 시 자동 Block List 추가
   - 수동 제거 후에도 시간 경과 후 재추가

3. **시스템 시간 차이**
   - 로그 기록: API 수락 시점
   - 실제 거부: 이후 보안 정책 적용 시점
   - 개발자는 성공으로 인식 → 실제 실패

---

## 결론 및 향후 대응

### 결론

**스마트 발신자 선택 시스템은 NCP + Daum 조합의 근본 문제를 해결할 수 없습니다.**

- 근본 원인: NCP의 자동 보안 정책 (개발자 제어 불가)
- 필요한 해결책: NCP 기술 지원팀의 화이트리스트 등록
- 현재 상황: Daum 사용자는 이메일 받을 수 없음

### 향후 접근 방법

#### 절대 하지 말 것
1. **발신자 로테이션 재시도** ← 이미 실패함
2. **추가 도메인 테스트** ← 같은 문제 발생 가능
3. **NCP 설정 변경 추측** ← 문제는 NCP 정책

#### 해야 할 것
1. **NCP 기술 지원팀 연락**
   ```
   문제: Daum 도메인으로 발송한 이메일이 NCP 보안 정책으로 자동 차단됨
   증거: NCP 콘솔 Block List 기록 (2025-11-21 22:21:05 이후)
   요청:
   - noreply@aed.pics, noreply@nmc.or.kr을 Daum 수신 허용 목록에 등록
   - 자동 Block List 추가 정책 검토
   ```

2. **회피 전략 (단기)**
   - Naver/Gmail/NMC 사용자만 이메일 발송 활성화
   - Daum 사용자는 임시 비활성화 또는 경고 메시지 표시

3. **대체 솔루션 (장기)**
   - 다른 이메일 발송 서비스(AWS SES, SendGrid 등) 평가
   - NCP 기술 지원 미응답 시 전환 검토

---

## 향후 참고를 위한 가이드

### 다시 스마트 발신자 선택을 고려할 때 읽을 것

**문제점을 명확히 기억하세요:**
1. 스마트 발신자 선택은 차단 문제의 근본 해결이 아님
2. NCP 자동 보안 정책(Block List 자동 추가)이 주요 장애물
3. 발신자 변경 = 차단 해제가 아님
4. 이메일 발송 로그와 실제 상태가 불일치할 수 있음

**대신 먼저 할 것:**
1. NCP 콘솔에서 Block List 상태 확인
2. NCP 기술 지원팀에 화이트리스트 등록 요청
3. 문제가 발신자 차단인지 도메인 차단인지 분류

### 키워드 (향후 검색용)
```
- Smart sender selector failure
- Daum email blocking NCP
- NCP Block List auto-add
- Email sender rotation ineffective
- noreply@aed.pics vs noreply@nmc.or.kr 무의미
- 스마트 발신자 선택 실패
- Daum 자동 차단 근본 해결 불가
- NCP 기술 지원팀 화이트리스트 필수
```

---

**작성 날짜**: 2025-11-22
**분석 대상**: 2025-11-21 15:01 ~ 2025-11-22 00:04 스마트 발신자 시스템 실제 배포 및 실패
**결과**: 실패 (완전히)
**권고**: 스마트 발신자 선택 시스템 비활성화, NCP 기술 지원팀 연락
**담당자**: Claude Code (AI)
