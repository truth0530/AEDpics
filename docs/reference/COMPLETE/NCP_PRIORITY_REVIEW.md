# NCP 전환 프로젝트 우선순위 재검토

**검토일**: 2025-10-25
**목적**: 국정원 인증 획득을 위한 최적 경로 수립

## 현재 상태 정확한 파악

### 1. 데이터베이스 ✅ (완료)
- **상태**: NCP PostgreSQL로 100% 전환 완료
- **연결**: Prisma ORM 사용
- **위치**: pg-3aqmb1.vpc-pub-cdb-kr.ntruss.com (한국)
- **데이터**: 315개 레코드 마이그레이션 완료

### 2. 인증 시스템 ⚠️ (Supabase 의존)
- **상태**: Supabase Auth 사용 중
- **위치**: 미국 서버
- **영향**: 30+ 파일 의존
- **문제**: 국정원 인증 불가능

### 3. 애플리케이션 ⚠️ (부분 완료)
- **프론트엔드**: Next.js 14 (한국에서 빌드 가능)
- **배포**: 설정만 있고 실제 배포는 안 됨
- **문제**: 인증 때문에 여전히 Supabase 필요

## 국정원 인증 요구사항 체크

| 요구사항 | 현재 상태 | 차단 요소 |
|---------|---------|----------|
| 데이터 한국 내 저장 | ✅ 완료 | - |
| 데이터베이스 한국 서버 | ✅ 완료 | NCP PostgreSQL |
| 인증 한국 서버 처리 | ❌ 미완료 | **Supabase Auth (미국)** |
| 세션 한국 서버 관리 | ❌ 미완료 | **Supabase Auth (미국)** |
| 해외 서비스 미사용 | ❌ 미완료 | **Supabase Auth** |
| 완전한 데이터 주권 | ❌ 미완료 | **Supabase 의존** |

**결론**: 인증 시스템이 국정원 인증의 가장 큰 차단 요소

## 우선순위 재평가

### 최우선 (Critical) - 국정원 인증 필수
**1. Supabase Auth → NextAuth.js 전환**
- 이유: 국정원 인증의 필수 조건
- 영향: 인증 관련 모든 기능
- 차단: 이것 없이는 국정원 인증 불가능
- 예상 시간: 2-3주

**중요도**: 🔴 최우선
**시급도**: 🔴 즉시
**차단도**: 🔴 완전 차단

### 높음 (High) - 기능 완성도
**2. AED 데이터 Import (81,331개)**
- 이유: 실제 운영 데이터 필요
- 영향: 시스템 실사용 가능 여부
- 차단: 테스트만 가능, 실운영 불가
- 예상 시간: 2-3시간

**중요도**: 🟠 높음
**시급도**: 🟢 보통
**차단도**: 🟠 부분 차단

**3. 환경 변수 보안 강화**
- 이유: 보안 사고 방지
- 영향: 데이터베이스 접근 권한
- 차단: 즉각적 위험
- 예상 시간: 완료됨 ✅

### 보통 (Medium) - 최적화
**4. Vercel/Supabase 패키지 정리**
- 이유: 불필요한 의존성 제거
- 영향: 빌드 크기, 유지보수
- 차단: 없음 (작동은 함)
- 예상 시간: 1-2시간

**5. 문서 정리 및 업데이트**
- 이유: 팀 협업, 유지보수
- 영향: 개발 효율성
- 차단: 없음
- 예상 시간: 완료됨 ✅

## 핵심 질문: 지금 무엇을 해야 하는가?

### 시나리오 A: 국정원 인증이 즉시 필요한 경우
**우선순위**:
1. 🔴 NextAuth.js 전환 (2-3주) - 필수
2. 🟠 AED 데이터 Import (2시간)
3. 🟡 Vercel 패키지 제거 (1시간)

**예상 기간**: 3주
**장점**: 국정원 인증 즉시 가능
**단점**: 다른 기능 개발 지연

### 시나리오 B: MVP 기능 완성이 우선인 경우
**우선순위**:
1. 🟠 AED 데이터 Import (2시간) - 즉시
2. 🟡 핵심 기능 개발 (점검, 보고서 등)
3. 🔴 NextAuth.js 전환 (MVP 완료 후)

**예상 기간**: MVP 완성 → 그 후 3주
**장점**: 빠른 MVP 완성, 기능 검증
**단점**: 국정원 인증 지연

## 현실적 권장사항

### 추천: 하이브리드 접근 (절충안)

**Week 1-2: 기반 작업**
1. AED 데이터 Import (즉시, 2시간)
2. NextAuth.js 인프라 준비 (Prisma 스키마, API 라우트)
3. 핵심 인증 페이지만 전환 (로그인/로그아웃)

**Week 3-4: 점진적 전환**
1. 인증 관련 페이지 순차 전환
2. 테스트 및 검증
3. 기존 기능 유지하며 병행

**Week 5: 완전 전환 및 테스트**
1. 모든 페이지 전환 완료
2. Supabase Auth 제거
3. 국정원 인증 준비 완료

**총 소요 기간**: 5주
**장점**: 
- 기능 개발과 병행 가능
- 단계적 검증으로 위험 최소화
- 롤백 가능

## 즉시 실행 가능한 작업 (오늘)

### 1. AED 데이터 Import (2시간)
```bash
# e-gen CSV 파일 다운로드 (사용자)
python3 scripts/upload_to_ncp.py data/e-gen/

# 검증
DATABASE_URL="..." npx tsx -e "
import { PrismaClient } from '@prisma/client'
const prisma = new PrismaClient()
const count = await prisma.aedData.count()
console.log('AED 데이터:', count, '개')
"
```

### 2. 환경변수 최종 확인
```bash
# .env.local 파일 존재 확인
ls -la .env.local

# DATABASE_URL 확인 (비밀번호는 가려서)
grep DATABASE_URL .env.local | sed 's/:.*@/:***@/'
```

### 3. Vercel 관련 최종 정리 (30분)
```bash
# package.json에서 불필요한 스크립트 제거
# - vercel-build
# - validate:data (Supabase 관련)
```

## 최종 권장 우선순위

### 즉시 (오늘)
1. ✅ 환경변수 보안 확인 (완료)
2. 🟠 AED 데이터 Import (2시간)
3. 🟡 package.json 정리 (30분)

### 단기 (1주일)
1. 🔴 NextAuth.js 인프라 준비
2. 🔴 핵심 인증 기능 전환
3. 🟢 기본 기능 테스트

### 중기 (2-4주)
1. 🔴 모든 인증 페이지 전환
2. 🔴 Supabase Auth 완전 제거
3. 🟢 국정원 인증 준비 완료

### 장기 (1-2개월)
1. 🟢 추가 기능 개발
2. 🟢 성능 최적화
3. 🟢 사용자 교육

## 의사결정 질문

**사용자에게 확인 필요**:

1. **국정원 인증 시급도**
   - A) 즉시 필요 (1개월 내) → NextAuth 우선
   - B) 3개월 후 → MVP 기능 우선

2. **현재 시스템 사용 현황**
   - 실 사용자가 있는가?
   - 테스트 단계인가?

3. **개발 리소스**
   - 전담 개발 가능한가?
   - 병행 개발 가능한가?

## 추천 결정

**국정원 인증이 목표**라면:

**즉시 시작**:
1. AED 데이터 Import (오늘, 2시간)
2. NextAuth.js 전환 시작 (내일부터, 2-3주)

**이유**:
- 데이터베이스는 이미 NCP로 전환 완료
- 인증만 남은 상태
- 지금 시작하면 3-4주 내 국정원 인증 가능

---

**결론**: 
가장 큰 우선순위는 **Supabase Auth → NextAuth.js 전환**
이것이 국정원 인증의 필수 조건이며 최대 차단 요소입니다.
