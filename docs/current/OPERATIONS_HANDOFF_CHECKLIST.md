# Phase 2 운영 인수인계 체크리스트

**목적**: Phase 2 기능이 안정적으로 운영 팀에 인수되었는지 확인
**상태**: Phase 2 완료 (2025-11-07)
**대상 팀**: 보건소 운영 담당자, 헬프데스크, 시스템 관리자

---

## 1. 운영 팀 문서 공유 체크리스트

### 1.1 사용자 가이드 공유
- [ ] 사용자 가이드 PDF 생성 완료
  ```bash
  # 권장: docs/guides/MODE_TOGGLE_USAGE_GUIDE.md를 PDF로 변환
  # (VS Code → Markdown Preview → Export as PDF 기능 사용)
  ```
- [ ] 보건소 운영 포털에 게시 완료
- [ ] 메인 페이지 또는 공지사항에 링크 추가 완료
- [ ] 이메일로 모든 보건소 담당자에게 발송 완료

**발송 내용 템플릿**:
```
제목: [안내] 점검 이력 조회 모드 토글 기능 안내

본문:
점검 관리 > 점검 이력 화면에서 "주소" / "관할보건소" 두 가지 조회 기준 중 하나를 선택할 수 있습니다.

- 주소: 당신의 지역에 물리적으로 설치된 AED
- 관할보건소: 당신의 보건소가 관리하는 모든 AED (타 지역 포함 가능)

자세한 내용은 첨부 파일을 참고해주세요.

문의사항: help@nmc.or.kr
```

### 1.2 FAQ 및 헬프데스크 자료
- [ ] 헬프데스크 담당자용 FAQ 교육 완료
  - 주요 Q&A 5개 (MODE_TOGGLE_USAGE_GUIDE.md의 섹션 6 참조)
  - 문제 해결 절차 (섹션 7 참조)
- [ ] 헬프데스크 스크립트 준비 완료
  ```
  Q: 왜 주소 모드와 관할보건소 모드 결과가 다른가요?
  A: 당신의 지역에 설치된 모든 장비와 당신의 보건소가 관리하는
     모든 장비가 항상 같지 않을 수 있습니다.
     상세 설명은 MODE_TOGGLE_USAGE_GUIDE.md의 "자주 묻는 질문" 참조
  ```
- [ ] 스크린샷 자료 준비 완료 (두 모드의 UI 차이)
- [ ] 운영 홈페이지 FAQ 섹션에 추가 완료

### 1.3 사용자 교육
- [ ] 교육 자료 준비 완료 (1-2장 PPT)
- [ ] 전국 보건소 담당자 대상 온라인 교육 실시
  - 일정: __ 월 __ 일 (약속 권장)
  - 인원: 250개 보건소 담당자
  - 소요 시간: 30분 (설명 + Q&A)
- [ ] 교육 자료 녹화 및 온라인 제공 완료
- [ ] 교육 후 피드백 수집 완료

---

## 2. 모니터링 및 운영 체크리스트

### 2.1 자동 검증 워크플로우
- [ ] 일일 검증 워크플로우 활성화 확인
  ```bash
  # GitHub Actions → verify-mode-logging-daily 워크플로우
  # 상태: enabled 확인
  ```
- [ ] 스케줄 확인: 매일 09:00 UTC (18:00 KST)
  ```bash
  # .github/workflows/verify-mode-logging-daily.yml
  # cron: '0 9 * * *' 확인
  ```
- [ ] 환경변수 설정 확인
  - `DATABASE_URL` secret이 설정되어 있는가?
  - Production DB 연결 정상인가?

### 2.2 로그 모니터링 절차
- [ ] PM2 로그 확인 방법 문서화
  ```bash
  # SSH로 프로덕션 서버 접근
  ssh aedpics_server

  # Mode 파라미터 확인
  pm2 logs app --lines 100 | grep "mode:"

  # 예상 출력
  # 2025-11-07 18:30:26 InspectionHistory:GET Filtering by jurisdiction
  # 2025-11-07 18:30:27 InspectionHistory:GET Mode parameter validated
  ```
- [ ] 일일 로그 확인 담당자 지정 완료
- [ ] 에러 발생 시 대응 절차 문서화 완료

### 2.3 실패 알림 설정
- [ ] GitHub Issue 자동 댓글 알림이 설정되어 있는가?
- [ ] 실패 시 받을 사람 지정 완료
- [ ] Slack/이메일 알림 추가 구성 (선택사항)

---

## 3. 프로덕션 검증 체크리스트

### 3.1 기능 정상 동작 확인
- [ ] 프로덕션 환경 (https://aed.pics) 접근 확인
- [ ] local_admin 계정으로 로그인 확인
- [ ] 점검 관리 → 점검 이력 화면 접근 확인
- [ ] 두 모드 선택 라디오 버튼이 보이는가? (주소 / 관할보건소)
- [ ] 모드 변경 시 결과가 다른가?
- [ ] 모드 선택이 저장되는가? (새로고침 후에도 유지)

### 3.2 성능 확인
- [ ] 느린 로딩 문제는 없는가?
- [ ] 응답 시간: <500ms (대량 데이터도)
- [ ] PM2 프로세스가 정상 작동하는가?
  ```bash
  pm2 status app
  # 상태: online 확인
  ```

### 3.3 데이터 무결성
- [ ] 점검 이력 데이터가 정상 조회되는가?
- [ ] FK (Foreign Key) 관계가 정상인가?
  ```bash
  # DB 점검 (선택사항)
  psql -c "SELECT COUNT(*) FROM inspections WHERE aed_data_id IS NOT NULL"
  # 결과: 32 (또는 그 이상)
  ```

---

## 4. 특정 지역 QA (선택사항이지만 권장)

### 4.1 테스트 지역 선택
모드 차이가 눈에 띄는 지역 선택:
- [ ] 제주시 보건소 (관할과 물리적 위치 차이 있음)
- [ ] 김해시 보건소 (관할과 물리적 위치 차이 있음)
- [ ] 기타: ________________

### 4.2 QA 절차
1. [ ] 해당 보건소 local_admin 계정으로 로그인
2. [ ] 점검 관리 → 점검 이력 화면 접근
3. [ ] "주소" 모드 선택 → 결과 개수 기록
   ```
   개수: ___ 건
   ```
4. [ ] "관할보건소" 모드 선택 → 결과 개수 기록
   ```
   개수: ___ 건
   ```
5. [ ] 두 결과가 다른가 확인
   - [ ] 다르면 통과 (모드가 정상 작동함)
   - [ ] 같으면 조사 필요 (관할과 주소가 일치하는 경우일 수 있음)
6. [ ] 각 모드의 화면 스크린샷 캡처 (선택사항)

### 4.3 예상 결과
```
제주시 보건소 예시:

주소 모드:
- 개수: 15건 (제주시에 설치된 모든 AED)

관할보건소 모드:
- 개수: 18건 (제주시가 관리하는 AED, 타 지역 포함)

결론: 차이 있음 = 모드가 정상 작동함
```

---

## 5. 문제 발생 시 대응 체크리스트

### 5.1 사용자가 "왜 다른가?"라고 문의한 경우
- [ ] MODE_TOGGLE_USAGE_GUIDE.md의 "자주 묻는 질문" 섹션 확인
- [ ] 특히 Q1, Q4, Q5 참조
- [ ] 명확한 설명 제공 (한글 템플릿):
  ```
  당신의 지역에 설치된 모든 AED와 당신의 보건소가 관리하는
  모든 AED가 항상 같지 않을 수 있습니다.

  예: 대구 중구에 있지만 당신의 보건소가 서울의 AED를 관리할 수 있습니다.

  따라서 두 모드의 결과가 다를 수 있습니다.
  ```

### 5.2 모드 토글이 작동하지 않는 경우
- [ ] 브라우저 캐시 삭제 후 재시작 요청
- [ ] 시크릿/프라이빗 모드에서 테스트 요청
- [ ] 기술팀 연락처로 보고
  ```
  - 계정: [사용자 이메일]
  - 증상: 모드 토글 버튼이 보이지 않음 / 작동하지 않음
  - 브라우저: [브라우저 정보]
  ```

### 5.3 일일 검증이 실패한 경우
- [ ] GitHub Actions 로그 확인
  ```
  GitHub → AEDpics repo → Actions → verify-mode-logging-daily
  → 최신 run 클릭 → 에러 로그 확인
  ```
- [ ] 일반적인 원인:
  - DATABASE_URL 환경변수 만료/변경됨
  - 네트워크 연결 문제
  - DB 접근 권한 문제
- [ ] 기술팀 연락처로 즉시 보고

### 5.4 프로덕션 배포 실패 시
- [ ] PM2 상태 확인
  ```bash
  pm2 status app
  # status: online 확인
  # status: errored 이면 문제 있음
  ```
- [ ] PM2 로그 확인
  ```bash
  pm2 logs app --err --lines 50
  ```
- [ ] 기술팀 연락처로 즉시 보고

---

## 6. 기술팀 연락처 및 에스컬레이션

### 즉시 보고 필요한 경우
```
상황: 프로덕션 장애 (사용자가 모드 토글 사용 불가)

연락:
1차: 시스템 관리자 → truth0530@nmc.or.kr
2차: 기술 지원 → inhak@nmc.or.kr
3차: 프로젝트 관리자 → woo@nmc.or.kr

포함 내용:
- 발생 시간
- 영향받는 계정/지역
- 에러 메시지 또는 스크린샷
- PM2 로그 (제공 가능한 경우)
```

---

## 7. 정기적 확인 사항

### 주간 점검 (매주 월요일)
- [ ] Daily verification workflow 전주 실행 상태 확인
- [ ] 에러나 예외 발생 여부 검토
- [ ] PM2 프로세스 상태 확인
- [ ] 사용자 문의 유무 및 트렌드 파악

### 월간 점검 (매월 1일)
- [ ] Phase 2 기능 사용률 파악
- [ ] 사용자 피드백 수집 및 정리
- [ ] 성능 지표 확인 (응답 시간, 에러율 등)
- [ ] 개선 사항 제안

### 분기별 검토 (매분기 초)
- [ ] Phase 2 안정성 평가
- [ ] Phase 3 준비 상황 검토
- [ ] 운영팀 피드백 반영

---

## 8. Phase 3 준비 상황 추적

### Phase 3로 이동 전 확인 사항
- [ ] Phase 2 모니터링 최소 2주 이상 안정화 확인
- [ ] 중대한 버그나 문제 없음 확인
- [ ] 보건소 운영팀으로부터 긍정적 피드백 수집
- [ ] Phase 3 상세 요구사항 정의 완료
- [ ] 리소스 할당 확정
- [ ] 일정 수립 완료

### Phase 3 선행 과제
- [ ] e-gen 데이터 동기화 설계
- [ ] 사진 스토리지 마이그레이션 (Supabase → NCP)
- [ ] 점검 통계 대시보드 기능 정의

---

## 9. 문서 참고 링크

| 문서 | 목적 | 대상 |
|------|------|------|
| [MODE_TOGGLE_USAGE_GUIDE.md](../guides/MODE_TOGGLE_USAGE_GUIDE.md) | 사용자 가이드 (1,600줄) | 보건소 담당자 |
| [PHASE2_COMPLETION_SUMMARY.md](PHASE2_COMPLETION_SUMMARY.md) | Phase 2 기술 요약 | 개발/운영팀 |
| [verify-mode-logging-daily.yml](../../.github/workflows/verify-mode-logging-daily.yml) | 자동 검증 워크플로우 | 시스템 관리자 |
| [CLAUDE.md](../../CLAUDE.md) - 섹션 3 | 핵심 권한 체계 | 개발팀 |

---

## 10. 최종 서명

### 인수인계 완료 확인
```
인수인계 담당자: ____________________
서명 및 날짜: ____________________

검수자: ____________________
서명 및 날짜: ____________________
```

### 운영 팀 확인
```
운영팀 담당자: ____________________
운영 시작 날짜: ____________________
```

---

## 11. 추가 노트

### 알려진 제약 사항
1. Mode 선택은 브라우저 localStorage에 저장됨
   - 다른 기기에서는 기본값(주소)으로 설정됨
   - 다른 브라우저에서도 기본값으로 설정됨

2. NULL aed_data_id 레코드는 필터링에서 제외됨
   - 기존 18개는 마이그레이션 완료됨
   - 향후 모든 새 inspection은 올바른 FK를 가짐

### 성능 특성
- 지역 필터: O(N) 스캔
- 보건소 필터: O(N) 스캔
- 81,464개 AED 데이터 상황에서도 <500ms 응답

### 향후 개선 계획
- 필터 성능 최적화 (인덱스 추가)
- 캐싱 전략 도입
- 실시간 대시보드 기능

---

**문서 버전**: 1.0.0
**작성일**: 2025-11-07
**상태**: Phase 2 운영 인수인계 중
**다음 검토**: 2025-11-14 (1주일 후)

