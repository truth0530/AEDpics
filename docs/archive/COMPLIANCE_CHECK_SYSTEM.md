# 의무설치기관 AED 설치현황 점검 시스템

## 개요

의무설치기관 대상 리스트(target_list_2024)와 실제 설치된 AED 데이터(aed_data)를 비교하여 설치 현황을 파악하는 시스템입니다.

## 시스템 특징

### 1. 유사도 기반 자동 매칭
- **명칭 유사도 분석 (60% 가중치)**
  - 완전 일치: 100점
  - 포함 관계: 90점
  - 약어 변환 매칭: 85점
  - 자모 분리 후 거리 계산: 0-100점

- **주소 유사도 분석 (40% 가중치)**
  - 시도/시군구 기반 토큰 매칭
  - 공통 토큰 비율로 점수 계산

- **신뢰도 등급**
  - 고신뢰 (90% 이상): 자동 매칭 가능
  - 중신뢰 (60-89%): 검토 필요
  - 저신뢰 (60% 미만): 수동 확인 필수

### 2. 복수 관리번호 처리

한 기관이 여러 관리번호로 분리 등록되는 경우를 고려한 설계:

```
예시: A요양병원
- 관리번호 1234: A요양병원 (의무) - 장비 2대
- 관리번호 2235: A요양병원 (비의무) - 장비 2대
- 관리번호 3236: A요양병원 구급차 (비의무) - 장비 2대
- 관리번호 4237: A요양병원 별관 (의무) - 장비 2대

→ 시스템은 이 모든 관리번호를 하나의 타겟 기관과 연결 가능
```

### 3. 보건소 담당자 워크플로우

1. **높은 신뢰도부터 순차 처리**
   - 100% 일치 항목 우선 확인
   - 90% 이상 고신뢰 항목 처리
   - 60-89% 중신뢰 항목 검토
   - 60% 미만 저신뢰 수동 확인

2. **직관적인 확인 인터페이스**
   - 타겟 기관 정보 표시
   - 매칭된 AED 목록 및 신뢰도 표시
   - "설치 확인" / "미설치" 버튼으로 처리

3. **진행 상황 추적**
   - 전체/완료/대기 통계
   - 설치율 실시간 계산
   - 지역별 현황 파악

## 데이터베이스 구조

### target_list_2024
- 2024년 기준 의무설치기관 목록
- 26,724개 기관 데이터
- 시도/시군구/기관명/분류 정보 포함

### aed_data
- 실제 설치된 AED 정보
- 81,464개 장비 데이터
- 관리번호별 복수 장비연번 포함

### management_number_group_mapping
- 관리번호와 타겟 기관 매칭 정보
- 연도별 분리 관리 (2024/2025)
- 신뢰도, 확인 상태, 수정 이력 추적

### target_list_devices
- 타겟 기관과 개별 장비 연결
- 매칭 방법 및 검증 정보 저장

## API 엔드포인트

### 1. 매칭 조회
```
GET /api/compliance/check
?year=2024
&sido=서울특별시
&gugun=강남구
&confidence_level=high
&search=병원
```

### 2. 상태 업데이트
```
POST /api/compliance/update
{
  "target_key": "서울_강남_병원_1",
  "status": "installed",
  "management_numbers": ["1234", "2235"],
  "year": "2024",
  "note": "현장 확인 완료"
}
```

### 3. 통계 조회
```
GET /api/compliance/statistics
?year=2024
&sido=서울특별시
```

응답:
- 전체/설치/미설치 수
- 설치율
- 지역별 통계
- 기관 분류별 통계
- 최근 확인 이력

## 업무 프로세스

### 기존 방식 (수기 작업)
1. 의무설치 대상 목록 확인
2. 엑셀에서 하나하나 검색
3. 설치 여부 수기 작성
4. 통계 수동 계산

### 개선된 방식 (시스템 활용)
1. 자동 매칭으로 후보 제시
2. 신뢰도 기반 우선순위 처리
3. 버튼 클릭으로 상태 기록
4. 실시간 통계 자동 계산

## 주요 기능

### 1. 유사도 매칭 알고리즘
- [lib/utils/similarity-matching.ts](../lib/utils/similarity-matching.ts)
- 한글 자모 분리 비교
- Levenshtein 거리 계산
- 병원 약어 변환 규칙

### 2. 확인 UI 컴포넌트
- [components/admin/compliance/ComplianceCheckPanel.tsx](../components/admin/compliance/ComplianceCheckPanel.tsx)
- 탭 기반 신뢰도 필터
- 카드형 확인 인터페이스
- 실시간 진행률 표시

### 3. 데이터 관리 API
- [app/api/compliance/check/route.ts](../app/api/compliance/check/route.ts)
- [app/api/compliance/update/route.ts](../app/api/compliance/update/route.ts)
- [app/api/compliance/statistics/route.ts](../app/api/compliance/statistics/route.ts)

## 사용 방법

### 1. 페이지 접속
```
/admin/compliance
```

### 2. 지역 및 연도 선택
- 상단 셀렉트 박스에서 연도 선택 (2024/2025)
- 관할 시도/시군구 필터링

### 3. 신뢰도별 처리
- 고신뢰 탭: 일괄 확정 가능
- 중신뢰 탭: 개별 검토 필요
- 저신뢰 탭: 신중한 확인 필수

### 4. 개별 확인
- 매칭 결과 검토
- "설치 확인" 또는 "미설치" 선택
- 자동으로 다음 항목 이동

### 5. 통계 확인
- 대시보드에서 전체 현황 파악
- 지역별/분류별 상세 통계
- 미설치 기관 리스트 추출

## 향후 개선 계획

1. **2025년 데이터 추가**
   - target_list_2025 테이블 준비
   - 연도 전환 자동화

2. **매칭 알고리즘 고도화**
   - 머신러닝 기반 유사도 계산
   - 과거 매칭 이력 학습

3. **보고서 자동 생성**
   - 관할지역 설치현황 리포트
   - 과태료 부과 대상 자동 추출

4. **모바일 지원**
   - 현장 점검용 모바일 UI
   - 오프라인 동기화

## 문의사항

- 시스템 관리: truth0530@nmc.or.kr
- 기술 지원: inhak@nmc.or.kr

---

마지막 업데이트: 2025-10-31