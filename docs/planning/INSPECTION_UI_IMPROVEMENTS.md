# 현장점검 UI 개선사항

**작성일**: 2025-11-13
**작성자**: 사용자 요청사항 정리

---

## 개선 필요 사항

### 1. 로드뷰 기본 상태 디바이스별 차별화

**현재 상태**:
- 모든 디바이스에서 동일한 기본값 사용
- 로드뷰가 접혀있는 상태가 기본값으로 보임

**개선 요구사항**:
- **PC 버전**: 로드뷰 펼치기가 기본값
  - 화면이 넓어서 지도와 로드뷰를 함께 볼 수 있음
  - 로드뷰가 펼쳐진 상태로 시작
- **모바일 버전**: 로드뷰 접기가 기본값 (현재 유지)
  - 화면이 작아서 지도만 보이는 것이 효율적
  - 필요시 사용자가 펼칠 수 있음

**구현 위치**:
- 파일: 점검 페이지 컴포넌트 (inspection 관련)
- 현재 확인된 페이지: `/inspection/13-0000745` (경북대학교치과병원)

**구현 방법**:
```typescript
// 예시 코드
const [isRoadViewExpanded, setIsRoadViewExpanded] = useState(() => {
  // PC: 기본 펼침, 모바일: 기본 접힘
  return window.innerWidth >= 1024; // Tailwind lg breakpoint
});

// 또는 useMediaQuery 훅 사용
const isPCView = useMediaQuery('(min-width: 1024px)');
const [isRoadViewExpanded, setIsRoadViewExpanded] = useState(isPCView);
```

**우선순위**: Medium
**예상 소요 시간**: 30분 ~ 1시간
**관련 컴포넌트**:
- 지도/로드뷰 토글 컴포넌트
- 점검 페이지 레이아웃

---

### 2. 정상 작동 여부 UI/UX 개선 및 버그 수정 🐛

**현재 문제**:
- "정상 작동 여부" 필드에서 "불량"을 선택한 후
- 다른 항목(필드)을 선택하거나 입력할 수 없게 되는 오류 발생
- 폼 전체가 비활성화되거나 인터랙션이 차단됨

**올바른 UI/UX 요구사항**:
1. **정상 작동 여부 선택**:
   - 처음부터 "정상" / "불량" 2가지 버튼 표시
   - 버튼 형태로 토글 선택 (라디오 버튼 스타일)

2. **불량 사유 조건부 표시**:
   - "불량" 버튼 클릭 시 → "불량 사유" 선택 UI 활성화/표시
   - "정상" 버튼 클릭 시 → "불량 사유" 숨김

3. **불량 사유 다중 선택**:
   - 체크박스 형태로 여러 개 선택 가능
   - 예시 항목: 배터리 부족, 패드 만료, 외관 손상, 작동 불가 등
   - 기타 사유 입력 필드 추가 가능

**예상 원인**:
1. **상태 관리 오류**:
   - "불량" 선택 시 상태 업데이트가 폼 전체를 비활성화
   - useState나 useForm의 disabled 상태가 잘못 설정됨

2. **이벤트 핸들러 문제**:
   - onChange 이벤트 핸들러가 다른 필드의 이벤트를 차단
   - event.stopPropagation() 또는 event.preventDefault() 과도 사용

3. **조건부 렌더링 로직 오류**:
   - "불량" 선택 시 특정 조건이 트리거되어 폼이 readonly로 변경
   - 유효성 검사 로직이 폼을 잠금

4. **폼 제출 로직 간섭**:
   - "불량" 선택 시 자동 제출 또는 검증 로직 실행
   - 폼이 제출 중(submitting) 상태로 변경되어 다른 입력 차단

**재현 단계**:
1. 점검 페이지 접속 (`/inspection/[equipment_serial]`)
2. "정상 작동 여부" 필드 찾기
3. "불량" 옵션 선택
4. 다른 필드 클릭 또는 입력 시도 → 실패

**디버깅 방법**:
```typescript
// 1. 상태 확인
console.log('Form state:', formState);
console.log('Is disabled:', isDisabled);

// 2. 이벤트 리스너 확인
// 정상 작동 여부 onChange 핸들러 검사

// 3. React DevTools로 상태 추적
// "불량" 선택 전후의 컴포넌트 상태 비교
```

**수정 방향**:
```typescript
// 잘못된 예
const handleStatusChange = (value: string) => {
  setOperationStatus(value);
  if (value === '불량') {
    setFormDisabled(true); // ❌ 폼 전체 비활성화
  }
};

// 올바른 예
const handleStatusChange = (value: string) => {
  setOperationStatus(value);
  // 불량 선택 시에도 폼은 계속 활성화 상태 유지
  // 필요하다면 특정 필드만 조건부로 표시
  if (value === '불량') {
    setShowDefectReasonField(true); // ✅ 추가 필드만 표시
  }
};
```

**구현 위치**:
- 파일: 점검 폼 컴포넌트 (inspection form)
- 페이지: `/inspection/[equipment_serial]`
- 관련 필드: "정상 작동 여부" (operation_status)

**우선순위**: **High (긴급)** - 사용자가 점검을 완료할 수 없는 치명적 버그
**예상 소요 시간**: 30분 ~ 1시간
**관련 컴포넌트**:
- 점검 폼 메인 컴포넌트
- 정상 작동 여부 입력 필드
- 폼 상태 관리 로직

**테스트 체크리스트**:
- [ ] "정상" 선택 → 다른 필드 입력 가능 확인
- [ ] "불량" 선택 → 다른 필드 입력 가능 확인
- [ ] "불량" 선택 → "정상"으로 변경 → 다른 필드 입력 가능 확인
- [ ] 모든 필드에서 정상적인 인터랙션 확인

---

### 3. 사진 촬영 기능 임시 비활성화

**현재 상태**:
- 시리얼 번호, 배터리, 본체 제조일자 사진 촬영 기능 활성화
- PhotoCaptureInput 컴포넌트로 구현됨

**요구사항**:
- 3가지 사진 촬영 기능을 화면에서 숨김
  1. 시리얼 번호 사진
  2. 배터리 사진
  3. 본체 제조일자 사진
- 향후 복구가 쉽도록 코드는 주석처리만 수행
- 완전 삭제 금지

**구현 방법**:
```typescript
// 컴포넌트 레벨에서 조건부 렌더링
const ENABLE_PHOTO_CAPTURE = false; // 복구 시 true로 변경

// JSX에서 조건부 표시
{ENABLE_PHOTO_CAPTURE && (
  <>
    <PhotoCaptureInput label="시리얼 번호" />
    <PhotoCaptureInput label="배터리" />
    <PhotoCaptureInput label="본체 제조일자" />
  </>
)}

// 또는 주석 처리
{/*
  <PhotoCaptureInput label="시리얼 번호" />
  <PhotoCaptureInput label="배터리" />
  <PhotoCaptureInput label="본체 제조일자" />
*/}
```

**복구 방법**:
- 조건부 렌더링 사용 시: `ENABLE_PHOTO_CAPTURE = true`로 변경
- 주석 처리 사용 시: 주석 해제

**구현 위치**:
- 파일: 점검 폼 컴포넌트 (inspection form)
- 페이지: `/inspection/[equipment_serial]`
- 관련 컴포넌트: PhotoCaptureInput

**우선순위**: Medium
**예상 소요 시간**: 15분 ~ 30분
**관련 컴포넌트**:
- PhotoCaptureInput.tsx
- 점검 폼 메인 컴포넌트

**주의사항**:
- 사진 업로드 API 엔드포인트는 유지 (향후 복구 대비)
- 데이터베이스 스키마의 photos 필드는 그대로 유지
- 기존에 저장된 사진 데이터는 영향 없음

---

### 4. 보관함 관련 필드 수정 및 정리

**현재 상태**:
- 제목: "보관함 형태"
- 옵션: 보관함 없음 / 벽걸이 / 스탠드
- 추가 필드: 보관함 안내문구, 비상연락망, 유효기간 표시 등
- 안내표지 설치 (다중선택 가능) - 별도 필드

**변경 요구사항**:

#### 1. 보관함 필드 변경
**현재**:
```
제목: 보관함 형태
옵션: 보관함 없음 / 벽걸이 / 스탠드
```

**변경 후**:
```
제목: 보관함 도난경보장치 작동 여부
옵션: 보관함 없음 / 정상작동 / 미작동
```

#### 2. 주석처리 대상 (향후 복구 가능하도록)
다음 필드들을 주석처리하여 화면에서 숨김:
- 보관함 안내문구
- 비상연락망
- 유효기간 표시
- 기타 보관함 관련 세부 항목들

#### 3. 유지 항목
- **안내표지 설치** (다중선택 가능) - 그대로 유지

**구현 방법**:
```typescript
// 보관함 필드 수정
<FormField
  label="보관함 도난경보장치 작동 여부"
  options={[
    { value: 'none', label: '보관함 없음' },
    { value: 'working', label: '정상작동' },
    { value: 'not_working', label: '미작동' }
  ]}
/>

// 주석처리 예시
{/*
  <FormField label="보관함 안내문구" />
  <FormField label="비상연락망" />
  <FormField label="유효기간 표시" />
*/}

// 또는 조건부 렌더링
const ENABLE_STORAGE_DETAILS = false; // 복구 시 true로 변경

{ENABLE_STORAGE_DETAILS && (
  <>
    <FormField label="보관함 안내문구" />
    <FormField label="비상연락망" />
    <FormField label="유효기간 표시" />
  </>
)}

// 안내표지 설치는 유지
<FormField
  label="안내표지 설치"
  type="checkbox"
  multiple={true}
/>
```

**구현 위치**:
- 파일: 점검 폼 컴포넌트 (inspection form)
- 페이지: `/inspection/[equipment_serial]`
- 섹션: 보관함 관련 입력 필드

**우선순위**: Medium
**예상 소요 시간**: 30분 ~ 1시간
**관련 컴포넌트**:
- 점검 폼 메인 컴포넌트
- 보관함 관련 입력 필드들

**주의사항**:
- 기존 데이터베이스의 보관함 관련 필드는 유지
- API 엔드포인트는 수정하지 않음 (향후 복구 대비)
- 주석처리된 필드는 쉽게 복구 가능하도록 명확히 표시

**테스트 체크리스트**:
- [ ] "보관함 도난경보장치 작동 여부" 필드 표시 확인
- [ ] 3가지 옵션 선택 가능 확인 (보관함 없음/정상작동/미작동)
- [ ] 주석처리된 필드들이 화면에 보이지 않는지 확인
- [ ] 안내표지 설치 필드는 정상 작동 확인 (다중선택)

---

### 5. 교육 관련 문구 수정

**현재 상태**:
- 관리책임자 교육
- 법정의무교육

**변경 요구사항**:
- 관리책임자 교육(100분)
- 법정의무교육(4시간)

**세부 내용**:
교육 항목에 교육 시간 정보를 괄호 안에 추가하여 사용자에게 명확한 정보 제공

**구현 방법**:
```typescript
// 현재
<FormField label="관리책임자 교육" />
<FormField label="법정의무교육" />

// 변경 후
<FormField label="관리책임자 교육(100분)" />
<FormField label="법정의무교육(4시간)" />
```

**구현 위치**:
- 파일: 점검 폼 컴포넌트 (inspection form)
- 페이지: `/inspection/[equipment_serial]`
- 섹션: 교육 관련 입력 필드

**우선순위**: Low (간단한 문구 수정)
**예상 소요 시간**: 5분 ~ 10분
**관련 컴포넌트**:
- 점검 폼 메인 컴포넌트
- 교육 관련 입력 필드

**주의사항**:
- 데이터베이스 필드명은 변경하지 않음
- UI 표시 문구만 수정

---

### 6. 점검 완료 후 PDF 출력 workflow 개선

**현재 상태**:
- 마지막 단계 하단 버튼: 이전, 중간저장, 완료
- "완료" 버튼 클릭 → PDF 출력 화면으로 자동 이동 (강제)
- PDF 출력 화면을 거쳐야만 다음 작업 진행 가능

**문제점**:
- 점검 완료 후 다음 점검/업무로 바로 넘어가고 싶은 경우
- PDF 출력 화면을 반드시 봐야 하는 불편함
- 사용자가 workflow를 선택할 수 없음

**변경 요구사항**:

#### 1. 버튼 구성 변경
**현재**:
```
[이전] [중간저장] [완료]
```

**변경 후**:
```
[이전] [중간저장] [PDF 출력] [완료]
```

#### 2. 각 버튼 동작 정의

**이전 버튼**:
- 기존과 동일: 이전 단계로 이동

**중간저장 버튼**:
- 기존과 동일: 현재 입력 내용 임시 저장
- 현재 화면 유지

**PDF 출력 버튼** (신규):
- **주요 기능**: MS Word 스타일의 출력 모드 화면으로 이동
- **자동 저장**: 버튼 클릭 시 점검 데이터 자동 저장 (중간저장 또는 완료 기능 수행)
- **화면 전환**: 다음 화면에서 출력 모드 활성화
- **용도**: PDF 출력이 필요한 사용자를 위한 선택적 기능

**완료 버튼** (동작 변경):
- **현재**: 완료 → PDF 출력 화면 자동 이동 (강제)
- **변경**: 완료 → 점검 완료 처리만 수행, PDF 출력 화면 이동 없음
- **이후**: 다음 점검 또는 다음 업무로 바로 이동 가능
- **데이터**: 점검 데이터 저장 및 완료 상태로 업데이트

#### 3. 사용자 시나리오

**시나리오 A - PDF 출력 필요 없음 (빠른 완료)**:
1. 마지막 단계 입력 완료
2. [완료] 버튼 클릭
3. 점검 완료 처리
4. 다음 점검 또는 업무 화면으로 바로 이동
5. ✅ **PDF 출력 화면을 거치지 않음**

**시나리오 B - PDF 출력 필요**:
1. 마지막 단계 입력 완료
2. [PDF 출력] 버튼 클릭
3. 점검 데이터 자동 저장
4. MS Word 스타일 출력 모드 화면으로 이동
5. PDF 출력/인쇄 수행
6. 이후 다음 작업 진행

**시나리오 C - 중간에 저장만**:
1. 마지막 단계 입력 중
2. [중간저장] 버튼 클릭
3. 임시 저장 후 현재 화면 유지
4. 나중에 이어서 작업

#### 4. 구현 세부사항

**PDF 출력 버튼 동작 플로우**:
```typescript
const handlePdfOutput = async () => {
  // 1. 점검 데이터 자동 저장
  const savedData = await saveInspectionData({
    ...formData,
    status: 'completed' // 완료 상태로 저장
  });

  // 2. 저장 성공 확인
  if (savedData.success) {
    // 3. PDF 출력 모드 화면으로 이동
    router.push(`/inspection/${equipmentSerial}/pdf-preview`);
  } else {
    // 에러 처리
    showError('저장에 실패했습니다.');
  }
};
```

**완료 버튼 동작 플로우**:
```typescript
const handleComplete = async () => {
  // 1. 점검 데이터 저장 및 완료 처리
  const savedData = await saveInspectionData({
    ...formData,
    status: 'completed'
  });

  // 2. 저장 성공 확인
  if (savedData.success) {
    // 3. 완료 메시지 표시
    showSuccessMessage('점검이 완료되었습니다.');

    // 4. 다음 화면으로 이동 (PDF 출력 화면 건너뜀)
    // 옵션 1: 점검 목록으로
    router.push('/inspections');
    // 옵션 2: 대시보드로
    // router.push('/dashboard');
    // 옵션 3: 다음 점검으로
    // router.push('/inspection/next');
  } else {
    showError('저장에 실패했습니다.');
  }
};
```

**버튼 UI 구현**:
```typescript
<div className="flex gap-2 justify-between">
  <Button
    variant="outline"
    onClick={handlePrevious}
  >
    이전
  </Button>

  <div className="flex gap-2">
    <Button
      variant="outline"
      onClick={handleTempSave}
    >
      중간저장
    </Button>

    <Button
      variant="secondary"
      onClick={handlePdfOutput}
      icon={<PrintIcon />}
    >
      PDF 출력
    </Button>

    <Button
      variant="primary"
      onClick={handleComplete}
    >
      완료
    </Button>
  </div>
</div>
```

**구현 위치**:
- 파일: 점검 폼 마지막 단계 컴포넌트
- 페이지: `/inspection/[equipment_serial]` (최종 단계)
- 관련 페이지: `/inspection/[equipment_serial]/pdf-preview` (신규 또는 수정)

**우선순위**: Medium
**예상 소요 시간**: 1시간 ~ 2시간
**관련 컴포넌트**:
- 점검 폼 네비게이션 버튼
- PDF 출력 모드 화면
- 점검 완료 처리 로직

**주의사항**:
- PDF 출력 버튼 클릭 시 데이터 유실 방지 (자동 저장 필수)
- 완료 버튼 클릭 후 뒤로가기 시 중복 완료 처리 방지
- 사용자에게 명확한 피드백 제공 (저장 완료, 완료 처리 등)

**테스트 체크리스트**:
- [ ] 중간저장 버튼 클릭 → 데이터 저장, 현재 화면 유지 확인
- [ ] PDF 출력 버튼 클릭 → 데이터 저장, PDF 출력 모드로 이동 확인
- [ ] 완료 버튼 클릭 → 데이터 저장, PDF 출력 화면 건너뛰고 다음 화면 이동 확인
- [ ] PDF 출력 버튼 사용 후 출력 모드에서 인쇄 기능 정상 작동 확인
- [ ] 각 버튼 클릭 시 데이터 유실 없는지 확인

**기대 효과**:
- 사용자에게 workflow 선택권 제공
- 점검 완료 후 빠른 작업 전환 가능
- PDF 출력이 필요한 경우에만 선택적으로 사용
- 전반적인 사용자 경험 개선

**추가 고려사항**:
- PDF 출력 화면에서 "돌아가기" 버튼 추가 (출력 후 점검 목록으로)
- 완료 버튼 클릭 후 이동 경로 설정 가능성 (사용자 설정 또는 기본값)
- 모바일 환경에서 버튼 레이아웃 최적화 (4개 버튼 배치)

---

## 다음 단계

### 우선순위 1 (긴급) - 정상 작동 여부 버그 수정
- [ ] 점검 폼 컴포넌트 파일 위치 확인
- [ ] "정상 작동 여부" onChange 핸들러 코드 검토
- [ ] 폼 상태 관리 로직 분석 (disabled, submitting 상태)
- [ ] 버그 원인 파악 (상태 관리, 이벤트 핸들러, 조건부 렌더링, 폼 제출 로직)
- [ ] 수정 구현 및 테스트
- [ ] 회귀 테스트 (다른 필드 정상 동작 확인)

### 우선순위 2 (일반) - 로드뷰 기본 상태 개선
- [ ] 지도/로드뷰 컴포넌트 파일 위치 확인
- [ ] useMediaQuery 또는 디바이스 감지 로직 구현
- [ ] 로드뷰 기본 상태 로직 수정 (PC: 펼침, 모바일: 접힘)
- [ ] PC/모바일 환경에서 테스트

### 우선순위 3 (일반) - 사진 촬영 기능 비활성화
- [ ] 점검 폼에서 PhotoCaptureInput 컴포넌트 사용 위치 파악
- [ ] 3가지 사진 입력 필드 주석처리 또는 조건부 렌더링 적용
  - 시리얼 번호 사진
  - 배터리 사진
  - 본체 제조일자 사진
- [ ] 화면에서 사진 입력 필드가 보이지 않는지 확인
- [ ] 향후 복구 가능성 검증 (주석 해제 테스트)

### 우선순위 4 (일반) - 보관함 관련 필드 수정 및 정리
- [ ] 보관함 필드 제목 및 옵션 변경
  - 제목: "보관함 형태" → "보관함 도난경보장치 작동 여부"
  - 옵션: "보관함 없음 / 벽걸이 / 스탠드" → "보관함 없음 / 정상작동 / 미작동"
- [ ] 세부 필드 주석처리
  - 보관함 안내문구
  - 비상연락망
  - 유효기간 표시
  - 기타 보관함 관련 항목들
- [ ] 안내표지 설치 필드는 유지 (다중선택)
- [ ] 변경사항 테스트

### 우선순위 5 (일반) - 교육 관련 문구 수정
- [ ] 교육 항목 라벨 수정
  - "관리책임자 교육" → "관리책임자 교육(100분)"
  - "법정의무교육" → "법정의무교육(4시간)"
- [ ] 변경사항 확인

### 우선순위 6 (일반) - 점검 완료 후 PDF 출력 workflow 개선
- [ ] 마지막 단계 버튼 구성 변경
  - 현재: [이전] [중간저장] [완료]
  - 변경: [이전] [중간저장] [PDF 출력] [완료]
- [ ] PDF 출력 버튼 구현
  - 자동 저장 기능 포함
  - MS Word 스타일 출력 모드로 화면 전환
- [ ] 완료 버튼 동작 수정
  - PDF 출력 화면으로 자동 이동 제거
  - 점검 완료 처리 후 다음 화면으로 직접 이동
- [ ] 사용자 시나리오 테스트
  - 시나리오 A: 빠른 완료 (PDF 출력 없음)
  - 시나리오 B: PDF 출력 후 완료
  - 시나리오 C: 중간저장만
- [ ] 모바일 환경에서 4개 버튼 레이아웃 최적화

---

## 요약

**총 6개 이슈**:
1. 로드뷰 기본 상태 (Medium 우선순위) - UX 개선
2. 정상 작동 여부 버그 (High 우선순위) - 치명적 버그 수정
3. 사진 촬영 기능 비활성화 (Medium 우선순위) - 임시 기능 숨김
4. 보관함 관련 필드 수정 (Medium 우선순위) - 필드 변경 및 정리
5. 교육 관련 문구 수정 (Low 우선순위) - 간단한 문구 수정
6. PDF 출력 workflow 개선 (Medium 우선순위) - 사용자 경험 개선

**권장 작업 순서**:
1. 긴급: 정상 작동 여부 버그 수정 (사용자가 점검을 완료할 수 없음)
2. 일반: 교육 관련 문구 수정 (가장 빠름, 5-10분)
3. 일반: 사진 촬영 기능 비활성화 (빠른 작업, 15-30분)
4. 일반: 보관함 관련 필드 수정 (30분-1시간)
5. 일반: PDF 출력 workflow 개선 (1-2시간)
6. 일반: 로드뷰 기본 상태 개선 (사용성 향상)

---

**참고**:
- 로드뷰: 사용자가 수동으로 토글한 경우 해당 상태 유지 (localStorage 활용 가능)
- 반응형 디자인 일관성 유지
- 모든 변경사항은 PC/모바일 환경 모두에서 테스트 필수
