# ìš´ì˜ ì •ì±… í†µí•© ë¬¸ì„œ

**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-09
**ìƒíƒœ**: âœ… êµ¬í˜„ ì™„ë£Œ ë° ìš´ì˜ ì¤‘
**í†µí•© ë¬¸ì„œ**: inspection-assignment-policy.md, map-sync-ux.md

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì ê²€ í• ë‹¹ ì •ì±…](#ì ê²€-í• ë‹¹-ì •ì±…)
3. [ì—­í• ë³„ ë™ì‘ ë°©ì‹](#ì—­í• ë³„-ë™ì‘-ë°©ì‹)
4. [ì§€ë„ ë™ê¸°í™” UX](#ì§€ë„-ë™ê¸°í™”-ux)
5. [ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„](#ë°ì´í„°ë² ì´ìŠ¤-ì„¤ê³„)
6. [API ì—”ë“œí¬ì¸íŠ¸](#api-ì—”ë“œí¬ì¸íŠ¸)
7. [êµ¬í˜„ ìƒíƒœ](#êµ¬í˜„-ìƒíƒœ)

---

## ì‹œìŠ¤í…œ ê°œìš”

### í•µì‹¬ ì •ì±…

AED ì ê²€ ì‹œìŠ¤í…œì˜ ìš´ì˜ ì •ì±…ì€ ë‘ ê°€ì§€ í•µì‹¬ ë©”ë‰´ë¥¼ ì¤‘ì‹¬ìœ¼ë¡œ ì‘ë™í•©ë‹ˆë‹¤:

1. **ìš°ì„ ìˆœìœ„ ë©”ë‰´**: ì ê²€ ê³„íš ìˆ˜ë¦½ ë° ì¼ì •ì¶”ê°€
2. **í˜„ì¥ì ê²€ ë©”ë‰´**: ì‹¤ì œ ì ê²€ ìˆ˜í–‰ (ì¼ì •ì¶”ê°€ëœ ì¥ë¹„ë§Œ)

### ì£¼ìš” ê¸°ëŠ¥

- **ì¼ì •ì¶”ê°€ ì‹œìŠ¤í…œ**: ì ê²€ ëŒ€ìƒ í™•ì • ë° í• ë‹¹
- **2ë‹¨ê³„ í•„í„°ë§**: ê´€í•  ì§€ì—­ + ì¼ì •ì¶”ê°€ ì—¬ë¶€
- **ì§€ë„ ìë™ ì´ˆê¸°í™”**: ë‚´ ìœ„ì¹˜ ê¸°ë°˜ ìë™ ì„¤ì •
- **í”Œë¡œíŒ… ë²„íŠ¼ UX**: ì§€ë„ ì´ë™ ì‹œ ëª…í™•í•œ í”¼ë“œë°±

---

## ì ê²€ í• ë‹¹ ì •ì±…

### í•µì‹¬ ì •ì±…

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì •ì±… 1: ì¼ì •ì¶”ê°€ = ì ê²€ ëŒ€ìƒ í™•ì •                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ìš°ì„ ìˆœìœ„ ë©”ë‰´ì—ì„œ "ì¼ì •ì¶”ê°€" ë²„íŠ¼ í´ë¦­                     â”‚
â”‚ - inspection_assignments í…Œì´ë¸”ì— í• ë‹¹ ê¸°ë¡ ìƒì„±             â”‚
â”‚ - í˜„ì¥ì ê²€ ë©”ë‰´ì— í•´ë‹¹ ì¥ë¹„ ë…¸ì¶œ                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì •ì±… 2: ì¼ì •ì¶”ê°€ í•˜ì§€ ì•Šì€ ì¥ë¹„ëŠ” í˜„ì¥ì ê²€ ë©”ë‰´ì—ì„œ ìˆ¨ê¹€     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ë³´ê±´ì†Œ ë‹´ë‹¹ì: ë³¸ì¸ì´ ì¶”ê°€í•œ ì¥ë¹„ë§Œ ë³´ì„                   â”‚
â”‚ - ì„ì‹œì ê²€ì›: ë³¸ì¸ì—ê²Œ í• ë‹¹ëœ ì¥ë¹„ë§Œ ë³´ì„                    â”‚
â”‚ - í• ë‹¹ë˜ì§€ ì•Šì€ ì¥ë¹„ëŠ” "ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²ƒì²˜ëŸ¼" ì²˜ë¦¬          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ì •ì±… 3: ì ê²€ ì™„ë£Œëœ ì¥ë¹„ëŠ” í˜„ì¥ì ê²€ ë©”ë‰´ì—ì„œ ë¹„í™œì„±í™”        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ - ì ê²€ ìƒíƒœê°€ 'completed'ì¸ ì¥ë¹„ëŠ” íšŒìƒ‰ í‘œì‹œ                â”‚
â”‚ - í´ë¦­ ë¶ˆê°€ ë˜ëŠ” "ì ê²€ ì™„ë£Œë¨" ì•ˆë‚´                         â”‚
â”‚ - ì¬ì ê²€ í•„ìš” ì‹œ ë‹¤ì‹œ ì¼ì •ì¶”ê°€ ê°€ëŠ¥                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ë©”ë‰´ë³„ ë¹„êµ

| ë©”ë‰´ | ëª©ì  | ëŒ€ìƒ ì¥ë¹„ | ì£¼ìš” ê¸°ëŠ¥ | ì‚¬ìš©ì |
|------|------|----------|----------|--------|
| **ìš°ì„ ìˆœìœ„** | ì ê²€ ê³„íš ìˆ˜ë¦½ | ì „ì²´ AED (ê´€í•  ë‚´) | ì¼ì •ì¶”ê°€, ìš°ì„ ìˆœìœ„ í™•ì¸ | ë³´ê±´ì†Œ ë‹´ë‹¹ì, ì‹œë„ì²­, ì¤‘ì•™ |
| **í˜„ì¥ì ê²€** | ì‹¤ì œ ì ê²€ ìˆ˜í–‰ | ì¼ì •ì¶”ê°€ëœ AEDë§Œ | ì ê²€ ì§„í–‰, ë°ì´í„° ê¸°ë¡ | ë³´ê±´ì†Œ ë‹´ë‹¹ì, ì„ì‹œì ê²€ì› |

---

## ì—­í• ë³„ ë™ì‘ ë°©ì‹

### 1. ë³´ê±´ì†Œ ë‹´ë‹¹ì (local_admin)

#### ìš°ì„ ìˆœìœ„ ë©”ë‰´
```typescript
// 1. ì „ì²´ ê´€í•  AED ëª©ë¡ ì¡°íšŒ (ìš°ì„ ìˆœìœ„ ì •ë ¬)
const aedList = await supabase
  .from('aed_inspection_status')
  .select('*')
  .eq('sido', user.organization.region_code)
  .eq('gugun', user.organization.city_code)
  .order('priority_score', { ascending: false });

// 2. "ì¼ì •ì¶”ê°€" ë²„íŠ¼ í´ë¦­
const addToSchedule = async (equipmentSerial: string) => {
  await supabase.from('inspection_assignments').insert({
    equipment_serial: equipmentSerial,
    assigned_to: user.id,
    assigned_by: user.id,
    assignment_type: 'scheduled',
    scheduled_date: selectedDate,
    status: 'pending'
  });
};
```

#### í˜„ì¥ì ê²€ ë©”ë‰´
```typescript
// ë³¸ì¸ì´ ì¼ì •ì¶”ê°€í•œ ì¥ë¹„ë§Œ ì¡°íšŒ
const assignedAEDs = await supabase
  .from('aed_data')
  .select('*, inspection_assignments!inner(*)')
  .eq('inspection_assignments.assigned_to', user.id)
  .eq('inspection_assignments.status', 'pending');
```

---

### 2. ì„ì‹œì ê²€ì› (temporary_inspector)

#### ìš°ì„ ìˆœìœ„ ë©”ë‰´ (ì ‘ê·¼ ë¶ˆê°€)
```typescript
// ì„ì‹œì ê²€ì›ì€ ìš°ì„ ìˆœìœ„ ë©”ë‰´ ìì²´ë¥¼ ë³¼ ìˆ˜ ì—†ìŒ
const canAccessPriorityMenu = (userRole: UserRole) => {
  return !['temporary_inspector'].includes(userRole);
};
```

#### í˜„ì¥ì ê²€ ë©”ë‰´ (í• ë‹¹ëœ ì¥ë¹„ë§Œ)
```typescript
// ë³´ê±´ì†Œ ë‹´ë‹¹ìê°€ ì„ì‹œì ê²€ì›ì—ê²Œ í• ë‹¹í•œ ì¥ë¹„ë§Œ ì¡°íšŒ
const myAssignedAEDs = await supabase
  .from('aed_data')
  .select('*, inspection_assignments!inner(*)')
  .eq('inspection_assignments.assigned_to', user.id)
  .eq('inspection_assignments.status', 'pending');
```

---

### 3. ì‹œë„ì²­ ë‹´ë‹¹ì (regional_admin)

#### ìš°ì„ ìˆœìœ„ ë©”ë‰´
```typescript
// ë³¸ì¸ ì‹œë„ ì „ì²´ AED ëª©ë¡ ì¡°íšŒ (ëª¨ë“  ë³´ê±´ì†Œ)
const regionalAEDs = await supabase
  .from('aed_inspection_status')
  .select('*, inspection_assignments(*)')
  .eq('sido', user.region)
  .order('priority_score', { ascending: false });

// ë³´ê±´ì†Œë³„ í• ë‹¹ í˜„í™© í†µê³„
<StatsSummary>
  <Stat label="ì „ì²´ AED" value={regionalAEDs.length} />
  <Stat label="ì¼ì •ì¶”ê°€ë¨" value={scheduledCount} />
  <Stat label="ë¯¸í• ë‹¹" value={unscheduledCount} />
</StatsSummary>
```

---

### 4. ì¤‘ì•™ì‘ê¸‰ì˜ë£Œì„¼í„°/ë³´ê±´ë³µì§€ë¶€ (emergency_center_admin, ministry_admin)

#### ìš°ì„ ìˆœìœ„ ë©”ë‰´
```typescript
// ì „êµ­ AED ëª©ë¡ ì¡°íšŒ
const nationalAEDs = await supabase
  .from('aed_inspection_status')
  .select('*, inspection_assignments(*)')
  .order('priority_score', { ascending: false });

// ì‹œë„ë³„ í• ë‹¹ í˜„í™© ëŒ€ì‹œë³´ë“œ
<NationalDashboard>
  {REGIONS.map(region => (
    <RegionCard key={region.code}>
      <h3>{region.label}</h3>
      <Stats>
        <Stat label="ì „ì²´ AED" value={regionStats[region.code].total} />
        <Stat label="ì¼ì •ì¶”ê°€" value={regionStats[region.code].scheduled} />
        <Stat label="ì ê²€ ì™„ë£Œ" value={regionStats[region.code].completed} />
      </Stats>
    </RegionCard>
  ))}
</NationalDashboard>
```

---

## ì§€ë„ ë™ê¸°í™” UX

### í•˜ì´ë¸Œë¦¬ë“œ UX ì „ëµ

**"ì§€ëŠ¥ì  ìë™í™” + ì‚¬ìš©ì ì œì–´ê¶Œ"**

1. **ì´ˆê¸° ë¡œë“œ ì‹œ**: ìë™ ë™ê¸°í™” (ì§ê´€ì„±)
2. **ì´ë™ ì¤‘**: í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ (ì•ˆì •ì„±)
3. **ëª…ì‹œì  ì¡°íšŒ**: ì‚¬ìš©ìê°€ ê²°ì • (ì œì–´ê¶Œ)

### UX í”Œë¡œìš°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 1: ì´ˆê¸° ë¡œë“œ (ìë™)                                â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ ì§€ë„ íƒ­ ì§„ì…                                             â”‚
â”‚     â†“                                                   â”‚
â”‚ ë‚´ ìœ„ì¹˜ ê°ì§€ (Geolocation API)                          â”‚
â”‚     â†“                                                   â”‚
â”‚ ì—­ì§€ì˜¤ì½”ë”© (Kakao Maps)                                 â”‚
â”‚     â†“                                                   â”‚
â”‚ í•„í„° ìë™ ì„¤ì •: "ì¶©ë‚¨, ì²œì•ˆì‹œ"                           â”‚
â”‚     â†“                                                   â”‚
â”‚ API í˜¸ì¶œ â†’ ë§ˆì»¤ í‘œì‹œ                                     â”‚
â”‚                                                         â”‚
â”‚ âœ… ì‚¬ìš©ì ê²½í—˜: "ë‚´ ì£¼ë³€ AEDê°€ ë°”ë¡œ ë³´ì¸ë‹¤!"              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 2: ì§€ë„ ì´ë™ (í”Œë¡œíŒ… ë²„íŠ¼)                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ ì‚¬ìš©ìê°€ ì§€ë„ ë“œë˜ê·¸/ì¤Œ                                   â”‚
â”‚     â†“                                                   â”‚
â”‚ ì§€ë„ ì¤‘ì‹¬ ë³€ê²½ ê°ì§€ (idle ì´ë²¤íŠ¸)                         â”‚
â”‚     â†“                                                   â”‚
â”‚ ì—­ì§€ì˜¤ì½”ë”©: "ëŒ€êµ¬ ìˆ˜ì„±êµ¬"                                â”‚
â”‚     â†“                                                   â”‚
â”‚ í”Œë¡œíŒ… ë²„íŠ¼ í‘œì‹œ:                                        â”‚
â”‚ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                            â”‚
â”‚ â”‚ ğŸ“ ì´ ì§€ì—­ ì¡°íšŒ           â”‚                            â”‚
â”‚ â”‚ ëŒ€êµ¬ ìˆ˜ì„±êµ¬               â”‚                            â”‚
â”‚ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                            â”‚
â”‚                                                         â”‚
â”‚ âš ï¸ í•„í„°ëŠ” "ì¶©ë‚¨, ì²œì•ˆì‹œ" ê·¸ëŒ€ë¡œ ìœ ì§€                      â”‚
â”‚ âš ï¸ API í˜¸ì¶œ ì•ˆ í•¨ (ì•ˆì •ì„± í™•ë³´)                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ STEP 3: ëª…ì‹œì  ì¡°íšŒ (ì‚¬ìš©ì ì œì–´)                        â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                         â”‚
â”‚ "ì´ ì§€ì—­ ì¡°íšŒ" ë²„íŠ¼ í´ë¦­                                  â”‚
â”‚     â†“                                                   â”‚
â”‚ í•„í„° ì—…ë°ì´íŠ¸: "ëŒ€êµ¬, ìˆ˜ì„±êµ¬"                             â”‚
â”‚     â†“                                                   â”‚
â”‚ API í˜¸ì¶œ â†’ ë§ˆì»¤ ì—…ë°ì´íŠ¸                                 â”‚
â”‚     â†“                                                   â”‚
â”‚ í”Œë¡œíŒ… ë²„íŠ¼ ìˆ¨ê¹€                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ì´ˆê¸° ë¡œë“œ ë¡œì§

```typescript
useEffect(() => {
  if (!map || !isMapLoaded || !isInitialLoadRef.current) return;

  // ë‚´ ìœ„ì¹˜ ê°ì§€
  navigator.geolocation.getCurrentPosition(
    (position) => {
      const lat = position.coords.latitude;
      const lng = position.coords.longitude;

      // ì§€ë„ ì¤‘ì‹¬ ì´ë™
      const moveLatLng = new window.kakao.maps.LatLng(lat, lng);
      map.setCenter(moveLatLng);

      // ì—­ì§€ì˜¤ì½”ë”©
      const geocoder = new window.kakao.maps.services.Geocoder();
      geocoder.coord2RegionCode(lng, lat, (result, status) => {
        if (status === window.kakao.maps.services.Status.OK) {
          const region = result.find((r) => r.region_type === 'H');
          if (region) {
            const sidoFull = region.region_1depth_name;
            const gugun = region.region_2depth_name;
            const sidoShort = normalizeRegionName(sidoFull);

            // âœ… í•„í„° ìë™ ì„¤ì • (ì´ˆê¸° ë¡œë“œ ì‹œì—ë§Œ)
            window.sessionStorage.setItem('selectedSido', sidoShort);
            window.sessionStorage.setItem('selectedGugun', gugun);

            // í•„í„°ë°”ì— ì•Œë¦¼
            window.dispatchEvent(new CustomEvent('mapRegionChanged', {
              detail: { sido: sidoShort, gugun, autoLoad: true }
            }));

            isInitialLoadRef.current = false;
          }
        }
      });
    },
    () => {
      // ìœ„ì¹˜ ê°ì§€ ì‹¤íŒ¨ ì‹œ ì„œìš¸ ì‹œì²­ìœ¼ë¡œ ê¸°ë³¸ ì„¤ì •
      const defaultLatLng = new window.kakao.maps.LatLng(37.5665, 126.9780);
      map.setCenter(defaultLatLng);
    }
  );
}, [map, isMapLoaded]);
```

### í”Œë¡œíŒ… ë²„íŠ¼ UI

```tsx
{/* í”Œë¡œíŒ… "ì´ ì§€ì—­ ì¡°íšŒ" ë²„íŠ¼ */}
{showRegionButton && pendingRegion && (
  <div className="absolute top-20 left-1/2 transform -translate-x-1/2 z-10 animate-slide-down">
    <button
      onClick={() => {
        // í•„í„° ì—…ë°ì´íŠ¸
        window.sessionStorage.setItem('selectedSido', pendingRegion.sido);
        window.sessionStorage.setItem('selectedGugun', pendingRegion.gugun);

        // í•„í„°ë°”ì— ì•Œë¦¼ (ìë™ ì¡°íšŒ íŠ¸ë¦¬ê±°)
        window.dispatchEvent(new CustomEvent('mapRegionChanged', {
          detail: {
            sido: pendingRegion.sido,
            gugun: pendingRegion.gugun,
            autoLoad: true
          }
        }));

        // ë²„íŠ¼ ìˆ¨ê¹€
        setShowRegionButton(false);
        setPendingRegion(null);
      }}
      className="bg-green-600 hover:bg-green-700 text-white px-6 py-3 rounded-lg shadow-lg"
    >
      <span className="text-2xl">ğŸ“</span>
      <div className="text-left">
        <div className="text-xs text-green-200">ì´ ì§€ì—­ ì¡°íšŒ</div>
        <div className="font-bold">{pendingRegion.sido} {pendingRegion.gugun}</div>
      </div>
    </button>
  </div>
)}
```

### ì§€ë„ 2ë‹¨ê³„ í•„í„°ë§ (í˜„ì¥ì ê²€ ë©”ë‰´)

**ê¶Œì¥: ë¹„í™œì„±í™” + êµ¬ë¶„ í‘œì‹œ**

```typescript
// components/inspection/FieldInspectionMap.tsx
export function FieldInspectionMap() {
  const user = useUser();

  // 1. ê´€í•  ì „ì²´ AED ì¡°íšŒ
  const { data: allAEDs } = useQuery({
    queryKey: ['jurisdiction-aeds', user.organization_id],
    queryFn: async () => {
      const res = await fetch('/api/aed-data', {
        method: 'POST',
        body: JSON.stringify({
          filters: {
            regionCodes: [user.organization.region_code],
            cityCodes: [user.organization.city_code]
          }
        })
      });
      return res.json();
    }
  });

  // 2. í• ë‹¹ëœ AED ëª©ë¡ ì¡°íšŒ
  const { data: assignedAEDs } = useQuery({
    queryKey: ['assigned-aeds', user.id],
    queryFn: () => fetch('/api/inspections/field/assigned').then(r => r.json())
  });

  // 3. í• ë‹¹ ì—¬ë¶€ ë§µ ìƒì„±
  const assignmentMap = useMemo(() => {
    const map = new Map();
    assignedAEDs?.data?.forEach((aed: any) => {
      map.set(aed.equipment_serial, aed);
    });
    return map;
  }, [assignedAEDs]);

  return (
    <KakaoMap center={userLocation} zoom={13}>
      {allAEDs?.data?.map((aed: AEDDevice) => {
        const assignment = assignmentMap.get(aed.equipment_serial);
        const isAssigned = !!assignment;
        const isCompleted = assignment?.assignment_status === 'completed';

        return (
          <Marker
            key={aed.equipment_serial}
            lat={aed.latitude}
            lng={aed.longitude}
            color={
              isCompleted ? 'gray' :    // ì ê²€ ì™„ë£Œ
              isAssigned ? 'blue' :     // ì¼ì •ì¶”ê°€ë¨
              'lightgray'               // ë¯¸í• ë‹¹ (ë¹„í™œì„±í™”)
            }
            opacity={isAssigned ? 1.0 : 0.4}
            disabled={!isAssigned || isCompleted}
            onClick={() => {
              if (!isAssigned) {
                toast.warning('ì¼ì •ì¶”ê°€ê°€ í•„ìš”í•œ ì¥ë¹„ì…ë‹ˆë‹¤.');
              } else if (isCompleted) {
                toast.info('ì´ë¯¸ ì ê²€ ì™„ë£Œëœ ì¥ë¹„ì…ë‹ˆë‹¤.');
              } else {
                router.push(`/inspection/${aed.equipment_serial}`);
              }
            }}
          >
            <MarkerContent>
              <h4>{aed.installation_institution}</h4>
              {isCompleted && <Badge color="gray">âœ“ ì ê²€ ì™„ë£Œ</Badge>}
              {isAssigned && !isCompleted && (
                <Badge color="blue">ì¼ì •ì¶”ê°€ë¨ ({assignment.scheduled_date})</Badge>
              )}
              {!isAssigned && <Badge color="lightgray">ì¼ì •ì¶”ê°€ í•„ìš”</Badge>}
            </MarkerContent>
          </Marker>
        );
      })}
    </KakaoMap>
  );
}
```

---

## ë°ì´í„°ë² ì´ìŠ¤ ì„¤ê³„

### inspection_assignments í…Œì´ë¸”

```sql
CREATE TABLE inspection_assignments (
  id UUID DEFAULT gen_random_uuid() PRIMARY KEY,

  -- í• ë‹¹ ëŒ€ìƒ
  equipment_serial VARCHAR(255) NOT NULL REFERENCES aed_data(equipment_serial),

  -- í• ë‹¹ ì •ë³´
  assigned_to UUID NOT NULL REFERENCES user_profiles(id),
  assigned_by UUID NOT NULL REFERENCES user_profiles(id),

  -- í• ë‹¹ íƒ€ì…
  assignment_type TEXT NOT NULL CHECK (assignment_type IN ('scheduled', 'urgent', 'follow_up')),

  -- ì¼ì • ì •ë³´
  scheduled_date DATE,
  scheduled_time TIME,

  -- ìƒíƒœ
  status TEXT NOT NULL DEFAULT 'pending' CHECK (status IN ('pending', 'in_progress', 'completed', 'cancelled')),

  -- ë©”íƒ€ë°ì´í„°
  notes TEXT,
  priority_level INT DEFAULT 0 CHECK (priority_level BETWEEN 0 AND 3),

  -- íƒ€ì„ìŠ¤íƒ¬í”„
  created_at TIMESTAMPTZ DEFAULT NOW() NOT NULL,
  updated_at TIMESTAMPTZ DEFAULT NOW(),
  completed_at TIMESTAMPTZ,
  cancelled_at TIMESTAMPTZ,

  -- ì¤‘ë³µ ë°©ì§€
  CONSTRAINT unique_active_assignment UNIQUE (equipment_serial, assigned_to, status)
    WHERE status IN ('pending', 'in_progress')
);

-- ì¸ë±ìŠ¤
CREATE INDEX idx_assignments_assigned_to_status
  ON inspection_assignments (assigned_to, status, scheduled_date DESC)
  WHERE status IN ('pending', 'in_progress');

CREATE INDEX idx_assignments_equipment_status
  ON inspection_assignments (equipment_serial, status, created_at DESC);

CREATE INDEX idx_assignments_scheduled_date
  ON inspection_assignments (scheduled_date DESC, status)
  WHERE status = 'pending';
```

**í˜„ì¬ ë ˆì½”ë“œ ìˆ˜**: 18ê°œ

### assigned_aed_list ë·° (í˜„ì¥ì ê²€ ëª©ë¡ìš©)

```sql
CREATE VIEW assigned_aed_list AS
SELECT
  a.*,  -- ëª¨ë“  aed_data í•„ë“œ

  -- í• ë‹¹ ì •ë³´
  ia.id AS assignment_id,
  ia.assigned_to,
  ia.assigned_by,
  ia.assignment_type,
  ia.scheduled_date,
  ia.status AS assignment_status,
  ia.notes AS assignment_notes,

  -- í• ë‹¹ì ì •ë³´
  up_assigned_by.full_name AS assigned_by_name,
  up_assigned_by.organization_id AS assigned_by_org,

  -- ìµœì‹  ì ê²€ ì •ë³´
  latest.id AS latest_inspection_id,
  latest.inspection_date AS last_inspection_date,
  latest.overall_status AS last_inspection_status,

  -- ì ê²€ í•„ìš”ì„± ê³„ì‚°
  CASE
    WHEN ia.status = 'completed' THEN 'completed'
    WHEN ia.status = 'in_progress' THEN 'in_progress'
    WHEN ia.scheduled_date < CURRENT_DATE THEN 'overdue'
    WHEN ia.scheduled_date = CURRENT_DATE THEN 'today'
    WHEN ia.scheduled_date <= CURRENT_DATE + INTERVAL '7 days' THEN 'upcoming'
    ELSE 'scheduled'
  END AS inspection_urgency

FROM aed_data a
INNER JOIN inspection_assignments ia ON a.equipment_serial = ia.equipment_serial
LEFT JOIN user_profiles up_assigned_by ON ia.assigned_by = up_assigned_by.id
LEFT JOIN LATERAL (
  SELECT id, equipment_serial, inspection_date, overall_status
  FROM aed_inspections
  WHERE equipment_serial = a.equipment_serial
  ORDER BY inspection_date DESC, created_at DESC
  LIMIT 1
) latest ON true

WHERE ia.status IN ('pending', 'in_progress');
```

---

## API ì—”ë“œí¬ì¸íŠ¸

### ì¼ì •ì¶”ê°€ API

```typescript
// POST /api/inspections/assignments
export async function POST(request: NextRequest) {
  const body = await request.json();
  const {
    equipmentSerial,
    assignedTo,
    scheduledDate,
    assignmentType,
    notes
  } = body;

  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  // 1. ì¤‘ë³µ ë°©ì§€
  const { data: existing } = await supabase
    .from('inspection_assignments')
    .select('id')
    .eq('equipment_serial', equipmentSerial)
    .eq('assigned_to', assignedTo)
    .in('status', ['pending', 'in_progress'])
    .maybeSingle();

  if (existing) {
    return NextResponse.json(
      { error: 'ì´ë¯¸ í• ë‹¹ëœ ì¥ë¹„ì…ë‹ˆë‹¤.' },
      { status: 409 }
    );
  }

  // 2. í• ë‹¹ ìƒì„±
  const { data, error } = await supabase
    .from('inspection_assignments')
    .insert({
      equipment_serial: equipmentSerial,
      assigned_to: assignedTo,
      assigned_by: user.id,
      assignment_type: assignmentType || 'scheduled',
      scheduled_date: scheduledDate,
      notes,
      status: 'pending'
    })
    .select()
    .single();

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 });
  }

  return NextResponse.json(data);
}
```

### í˜„ì¥ì ê²€ ëª©ë¡ API

```typescript
// GET /api/inspections/field/assigned
export async function GET(request: NextRequest) {
  const supabase = await createClient();
  const { data: { user } } = await supabase.auth.getUser();

  if (!user) {
    return NextResponse.json({ error: 'Unauthorized' }, { status: 401 });
  }

  // ì—­í• ë³„ ì¿¼ë¦¬
  let query = supabase
    .from('assigned_aed_list')
    .select('*')
    .order('inspection_urgency', { ascending: true })
    .order('scheduled_date', { ascending: true });

  // ë³¸ì¸ì—ê²Œ í• ë‹¹ëœ ì¥ë¹„ë§Œ
  query = query.eq('assigned_to', user.id);

  // ì ê²€ ëŒ€ê¸° ì¤‘ ë˜ëŠ” ì§„í–‰ ì¤‘ë§Œ
  query = query.in('assignment_status', ['pending', 'in_progress']);

  const { data, error } = await query;

  if (error) {
    return NextResponse.json({ error: error.message }, { status: 500 });
  }

  return NextResponse.json({
    data,
    stats: {
      total: data.length,
      overdue: data.filter(d => d.inspection_urgency === 'overdue').length,
      today: data.filter(d => d.inspection_urgency === 'today').length,
      upcoming: data.filter(d => d.inspection_urgency === 'upcoming').length,
      in_progress: data.filter(d => d.assignment_status === 'in_progress').length
    }
  });
}
```

---

## êµ¬í˜„ ìƒíƒœ

### âœ… ì™„ë£Œëœ ê¸°ëŠ¥ (2025-10-09)

1. **ì ê²€ í• ë‹¹ ì‹œìŠ¤í…œ**
   - inspection_assignments í…Œì´ë¸” (18ê°œ ë ˆì½”ë“œ)
   - assigned_aed_list ë·°
   - ì¼ì •ì¶”ê°€ API
   - í• ë‹¹ëœ ëª©ë¡ API

2. **ì§€ë„ ì´ˆê¸°í™” ì •ì±…**
   - ë‚´ ìœ„ì¹˜ ê¸°ë°˜ ìë™ ì„¤ì •
   - ì—­ì§€ì˜¤ì½”ë”© í†µí•©
   - í•„í„° ìë™ ë™ê¸°í™”

3. **2ë‹¨ê³„ í•„í„°ë§**
   - ê´€í•  ì§€ì—­ í•„í„°
   - ì¼ì •ì¶”ê°€ ì—¬ë¶€ í•„í„°
   - ë¹„í™œì„±í™” ë§ˆì»¤ í‘œì‹œ

4. **ì—­í• ë³„ ê¶Œí•œ ì œì–´**
   - ë³´ê±´ì†Œ ë‹´ë‹¹ì ì „ì²´ ê¸°ëŠ¥
   - ì„ì‹œì ê²€ì› ì œí•œ ê¸°ëŠ¥
   - ì‹œë„ì²­/ì¤‘ì•™ ëª¨ë‹ˆí„°ë§

### â³ ê³„íš ì¤‘ì¸ ê¸°ëŠ¥

1. **í”Œë¡œíŒ… ë²„íŠ¼ UX**
   - ì§€ë„ ì´ë™ ì‹œ "ì´ ì§€ì—­ ì¡°íšŒ" ë²„íŠ¼
   - 3ì´ˆ ìë™ ìˆ¨ê¹€
   - ì• ë‹ˆë©”ì´ì…˜

2. **ëŒ€ëŸ‰ í• ë‹¹ ë„êµ¬**
   - CSV ì—…ë¡œë“œ
   - ì¼ê´„ í• ë‹¹ ì²˜ë¦¬

3. **í• ë‹¹ í†µê³„ ëŒ€ì‹œë³´ë“œ**
   - ì‹œë„ë³„ í• ë‹¹ í˜„í™©
   - ì ê²€ ì§„í–‰ë¥  ëª¨ë‹ˆí„°ë§

---

## ìš´ì˜ ê°€ì´ë“œ

### ì£¼ì˜ì‚¬í•­

**ì ˆëŒ€ ê¸ˆì§€ ì‚¬í•­**:
1. âŒ inspection_assignments í…Œì´ë¸” ì§ì ‘ ìˆ˜ì • ê¸ˆì§€
2. âŒ assigned_aed_list ë·° ì •ì˜ ë³€ê²½ ê¸ˆì§€
3. âŒ ì¤‘ë³µ í• ë‹¹ í—ˆìš© ê¸ˆì§€ (UNIQUE ì œì•½ì¡°ê±´ ì¤€ìˆ˜)

**ê¶Œì¥ ì‚¬í•­**:
1. âœ… ì¼ì •ì¶”ê°€ ì „ ì¤‘ë³µ í™•ì¸
2. âœ… ì ê²€ ì™„ë£Œ ì‹œ assignment status ì—…ë°ì´íŠ¸
3. âœ… ì£¼ê¸°ì  í†µê³„ í™•ì¸ (í• ë‹¹ë¥ , ì™„ë£Œìœ¨)

### ëª¨ë‹ˆí„°ë§ ì¿¼ë¦¬

**ë¯¸í• ë‹¹ AED í™•ì¸**:
```sql
SELECT COUNT(*)
FROM aed_data a
LEFT JOIN inspection_assignments ia ON a.equipment_serial = ia.equipment_serial
  AND ia.status IN ('pending', 'in_progress')
WHERE ia.id IS NULL;
```

**í• ë‹¹ í†µê³„**:
```sql
SELECT
  assignment_type,
  status,
  COUNT(*) as count
FROM inspection_assignments
GROUP BY assignment_type, status;
```

**ì§€ì—° ì ê²€ í™•ì¸**:
```sql
SELECT *
FROM inspection_assignments
WHERE status = 'pending'
  AND scheduled_date < CURRENT_DATE
ORDER BY scheduled_date ASC;
```

---

## ë§ˆì´ê·¸ë ˆì´ì…˜

### âœ… ì™„ë£Œëœ ë§ˆì´ê·¸ë ˆì´ì…˜

| ë²ˆí˜¸ | íŒŒì¼ëª… | ì„¤ëª… | ì‹¤í–‰ì¼ |
|------|--------|------|--------|
| 20251005 | [20251005_inspection_assignments.sql](../../supabase/migrations/20251005_inspection_assignments.sql) | ì ê²€ í• ë‹¹ ì‹œìŠ¤í…œ (í…Œì´ë¸”, ë·°, RLS) | 2025-10-05 |

**í˜„ì¬ ìƒíƒœ**: 18ê°œ í• ë‹¹ ìš´ì˜ ì¤‘

**í•µì‹¬ êµ¬ì„± ìš”ì†Œ**:
- `inspection_assignments` í…Œì´ë¸” - ì ê²€ ì¼ì •ì¶”ê°€ ë° í• ë‹¹ ê´€ë¦¬
- `assigned_aed_list` ë·° - í˜„ì¥ì ê²€ ëª©ë¡ìš© (ì„¸ì…˜ ì •ë³´ í¬í•¨)
- RLS ì •ì±… - ë³¸ì¸ í• ë‹¹/ë³¸ì¸ì´ ìƒì„±í•œ ê¸°ë¡ë§Œ ì ‘ê·¼
- EXCLUDE ì œì•½ì¡°ê±´ - ì¤‘ë³µ í• ë‹¹ ë°©ì§€ (btree_gist í™•ì¥ ì‚¬ìš©)

### ğŸ“š ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„¸ ê°€ì´ë“œ

- [MIGRATION_GUIDE.md](../reference/MIGRATION_GUIDE.md) - ì „ì²´ ë§ˆì´ê·¸ë ˆì´ì…˜ ê°€ì´ë“œ
  - Phase 8: ì ê²€ í• ë‹¹ ì‹œìŠ¤í…œ (20251005ë²ˆ)
  - ê²€ì¦ ì¿¼ë¦¬ ë° ì£¼ì˜ì‚¬í•­
  - assigned_aed_list ë·° ìƒì„¸ ì„¤ëª…

---

## ì°¸ê³  ë¬¸ì„œ

- **ë§ˆì´ê·¸ë ˆì´ì…˜**: [MIGRATION_GUIDE.md](../reference/MIGRATION_GUIDE.md) - ë°ì´í„°ë² ì´ìŠ¤ ë§ˆì´ê·¸ë ˆì´ì…˜ ì „ì²´ ê°€ì´ë“œ
- **ì ê²€ ì‹œìŠ¤í…œ**: [INSPECTION_SYSTEM.md](./INSPECTION_SYSTEM.md) - 8ë‹¨ê³„ ì ê²€ í”„ë¡œì„¸ìŠ¤
- **ë§¤í•‘ ì‹œìŠ¤í…œ**: [MAPPING_SYSTEM.md](./MAPPING_SYSTEM.md) - êµ¬ë¹„ì˜ë¬´ê¸°ê´€ ë§¤í•‘
- **ì§€ë„ ì´ˆê¸°í™”**: [2025-10-06-map-init-policy.md](../reports/2025-10-06-map-init-policy.md)
- **í”„ë¡œì íŠ¸ ìƒíƒœ**: [PROJECT_STATUS.md](../PROJECT_STATUS.md)

---

**ì‘ì„±**: AED Smart Check ê°œë°œíŒ€
**ìµœì¢… ì—…ë°ì´íŠ¸**: 2025-10-09
**ìƒíƒœ**: âœ… ìš´ì˜ ì¤‘
**ë ˆì½”ë“œ**: inspection_assignments 18ê°œ ìš´ì˜ ì¤‘
